import {
  createSource
} from "../chunks/GQOZEVKC.chunk.js";
import {
  simpleHook,
  simpleReactProvider
} from "../chunks/ZJZ7MIQU.chunk.js";
import {
  REACTION_STACK
} from "../chunks/HVJOCNRK.chunk.js";
import {
  watch
} from "../chunks/A2LO2IKU.chunk.js";
import {
  FIELDS_PREFIX
} from "../chunks/GWKM27VZ.chunk.js";

// packages/reaction/reaction.ts
var Reaction = class {
  constructor(name, scheduler) {
    this.dependencies = /* @__PURE__ */ new Map();
    this.isDisposed = false;
    this.onUpdate = (updatedProp) => {
      console.log("ON UPDATE", this.dependencies.entries());
      for (const [, props] of this.dependencies.entries()) {
        if (props.has(updatedProp)) {
          this.scheduler();
          return;
        }
      }
    };
    this.name = name;
    this.scheduler = scheduler;
  }
  track(fn) {
    console.log("TRACL", this.name, this.isDisposed);
    if (this.isDisposed) return fn();
    REACTION_STACK.push(this);
    try {
      return fn();
    } finally {
      REACTION_STACK.pop();
    }
  }
  reportDependency(store, prop) {
    if (this.isDisposed) return;
    let deps = this.dependencies.get(store);
    if (!deps) {
      deps = /* @__PURE__ */ new Set();
      this.dependencies.set(store, deps);
      store[`${FIELDS_PREFIX}onUpdate`].push(this.onUpdate);
    }
    deps.add(prop);
  }
  updateScheduler(scheduler) {
    this.scheduler = scheduler;
  }
  undispose() {
    this.isDisposed = false;
  }
  dispose() {
    if (this.isDisposed) return;
    for (const store of this.dependencies.keys()) {
      const index = store[`${FIELDS_PREFIX}onUpdate`].indexOf(this.onUpdate);
      if (index > -1) {
        store[`${FIELDS_PREFIX}onUpdate`].splice(index, 1);
      }
    }
    this.dependencies.clear();
    this.isDisposed = true;
  }
};

// packages/react-provider/hookAndHok.ts
import { useReducer, useRef, useEffect } from "react";
function createHOCWrapper(store, Component) {
  const HOCWrapper = (props) => {
    const [, forceUpdate] = useReducer((x) => x + 1, 0);
    const reactionRef = useRef(null);
    if (reactionRef.current === null) {
      reactionRef.current = new Reaction(`${Component.name}_Observer`, forceUpdate);
    }
    reactionRef.current.updateScheduler(forceUpdate);
    useEffect(() => {
      reactionRef.current.undispose();
      return () => reactionRef.current.dispose();
    }, [reactionRef.current]);
    return reactionRef.current.track(() => {
      return Component(props);
    });
  };
  HOCWrapper.displayName = `RepkaObserver(${Component.displayName || Component.name})`;
  return HOCWrapper;
}
function isReactComponent(arg) {
  return typeof arg === "function" && /^[A-Z]/.test(arg.name);
}
function repkaHookAndHoc(arg) {
  if (arg && typeof arg !== "string" && isReactComponent(arg)) {
    return createHOCWrapper(this, arg);
  }
  try {
    return simpleHook(this, typeof arg);
  } catch (e) {
    console.error("[Repka] \u041E\u0448\u0438\u0431\u043A\u0430 \u0432\u044B\u0437\u043E\u0432\u0430 \u0445\u0443\u043A\u0430. \u0423\u0431\u0435\u0434\u0438\u0442\u0435\u0441\u044C, \u0447\u0442\u043E state() \u0432\u044B\u0437\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043D\u0430 \u0432\u0435\u0440\u0445\u043D\u0435\u043C \u0443\u0440\u043E\u0432\u043D\u0435 \u043A\u043E\u043C\u043F\u043E\u043D\u0435\u043D\u0442\u0430.", e);
    return this;
  }
}

// packages/repka/index.ts
var repka = (obj) => createSource(
  obj,
  { main: repkaHookAndHoc, getter: simpleReactProvider }
);
export {
  repka,
  watch
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vcGFja2FnZXMvcmVhY3Rpb24vcmVhY3Rpb24udHMiLCAiLi4vLi4vcGFja2FnZXMvcmVhY3QtcHJvdmlkZXIvaG9va0FuZEhvay50cyIsICIuLi8uLi9wYWNrYWdlcy9yZXBrYS9pbmRleC50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgRklFTERTX1BSRUZJWCB9IGZyb20gXCJjb3JlL2RvbWFpblwiO1xuaW1wb3J0IHsgUkVBQ1RJT05fU1RBQ0sgfSBmcm9tIFwicmVhY3Rpb25cIjtcblxudHlwZSBTdG9yZSA9IHtcbiAgW2BfX1JFUE9fX29uVXBkYXRlYF06ICgocHJvcDogc3RyaW5nKSA9PiB2b2lkKVtdO1xufTtcblxuZXhwb3J0IGNsYXNzIFJlYWN0aW9uIHtcbiAgcHJpdmF0ZSBuYW1lOiBzdHJpbmc7XG4gIHByaXZhdGUgc2NoZWR1bGVyOiAoKSA9PiB2b2lkO1xuICBwcml2YXRlIGRlcGVuZGVuY2llcyA9IG5ldyBNYXA8U3RvcmUsIFNldDxzdHJpbmc+PigpO1xuICBwcml2YXRlIGlzRGlzcG9zZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIHNjaGVkdWxlcjogKCkgPT4gdm9pZCkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7XG4gIH1cblxuICB0cmFjazxUPihmbjogKCkgPT4gVCk6IFQge1xuICAgIGNvbnNvbGUubG9nKCdUUkFDTCcsIHRoaXMubmFtZSwgdGhpcy5pc0Rpc3Bvc2VkKVxuICAgIGlmICh0aGlzLmlzRGlzcG9zZWQpIHJldHVybiBmbigpO1xuXG4gICAgUkVBQ1RJT05fU1RBQ0sucHVzaCh0aGlzKTtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGZuKCk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIFJFQUNUSU9OX1NUQUNLLnBvcCgpO1xuICAgIH1cbiAgfVxuXG4gIHJlcG9ydERlcGVuZGVuY3koc3RvcmU6IFN0b3JlLCBwcm9wOiBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5pc0Rpc3Bvc2VkKSByZXR1cm47XG5cbiAgICBsZXQgZGVwcyA9IHRoaXMuZGVwZW5kZW5jaWVzLmdldChzdG9yZSk7XG4gICAgaWYgKCFkZXBzKSB7XG4gICAgICBkZXBzID0gbmV3IFNldCgpO1xuICAgICAgdGhpcy5kZXBlbmRlbmNpZXMuc2V0KHN0b3JlLCBkZXBzKTtcblxuICAgICAgc3RvcmVbYCR7RklFTERTX1BSRUZJWH1vblVwZGF0ZWBdLnB1c2godGhpcy5vblVwZGF0ZSk7IFxuICAgIH1cbiAgICBkZXBzLmFkZChwcm9wKTtcbiAgfVxuXG4gIHByaXZhdGUgb25VcGRhdGUgPSAodXBkYXRlZFByb3A6IHN0cmluZykgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdPTiBVUERBVEUnLCB0aGlzLmRlcGVuZGVuY2llcy5lbnRyaWVzKCkpXG4gICAgZm9yIChjb25zdCBbLHByb3BzXSBvZiB0aGlzLmRlcGVuZGVuY2llcy5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChwcm9wcy5oYXModXBkYXRlZFByb3ApKSB7XG4gICAgICAgIHRoaXMuc2NoZWR1bGVyKCk7XG4gICAgICAgIHJldHVybjsgXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgdXBkYXRlU2NoZWR1bGVyKHNjaGVkdWxlcjogKCkgPT4gdm9pZCkge1xuXHUwMEEwIFx1MDBBMCB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjtcblx1MDBBMCB9XG4gIHVuZGlzcG9zZSgpIHtcblx1MDBBMCBcdTAwQTAgdGhpcy5pc0Rpc3Bvc2VkID0gZmFsc2U7XG5cdTAwQTAgfVxuXG4gIGRpc3Bvc2UoKSB7XG4gICAgaWYgKHRoaXMuaXNEaXNwb3NlZCkgcmV0dXJuO1xuXG4gICAgZm9yIChjb25zdCBzdG9yZSBvZiB0aGlzLmRlcGVuZGVuY2llcy5rZXlzKCkpIHtcbiAgICAgIGNvbnN0IGluZGV4ID0gc3RvcmVbYCR7RklFTERTX1BSRUZJWH1vblVwZGF0ZWBdLmluZGV4T2YodGhpcy5vblVwZGF0ZSk7XG4gICAgICBpZiAoaW5kZXggPiAtMSkge1xuICAgICAgICBzdG9yZVtgJHtGSUVMRFNfUFJFRklYfW9uVXBkYXRlYF0uc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kZXBlbmRlbmNpZXMuY2xlYXIoKTtcbiAgICB0aGlzLmlzRGlzcG9zZWQgPSB0cnVlO1xuICB9XG59XG4iLCAiaW1wb3J0IFJlYWN0LCB7IHVzZVJlZHVjZXIsIHVzZVJlZiwgdXNlRWZmZWN0IH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBSZWFjdGlvbiB9IGZyb20gJ3JlYWN0aW9uL3JlYWN0aW9uJztcbmltcG9ydCB7IHNpbXBsZUhvb2sgfSBmcm9tICcuL2luZGV4JztcblxuZnVuY3Rpb24gY3JlYXRlSE9DV3JhcHBlcihzdG9yZTogYW55LCBDb21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudFR5cGUpIHtcbmNvbnN0IEhPQ1dyYXBwZXI6IFJlYWN0LkZDPGFueT4gPSAocHJvcHMpID0+IHtcblx1MDBBMCBcdTAwQTAgY29uc3QgWywgZm9yY2VVcGRhdGVdID0gdXNlUmVkdWNlcih4ID0+IHggKyAxLCAwKTtcblxuXHUwMEEwIFx1MDBBMCBjb25zdCByZWFjdGlvblJlZiA9IHVzZVJlZjxSZWFjdGlvbiB8IG51bGw+KG51bGwpO1xuXG5cdTAwQTAgXHUwMEEwIGlmIChyZWFjdGlvblJlZi5jdXJyZW50ID09PSBudWxsKSB7XG5cdTAwQTAgXHUwMEEwIFx1MDBBMCByZWFjdGlvblJlZi5jdXJyZW50ID0gbmV3IFJlYWN0aW9uKGAke0NvbXBvbmVudC5uYW1lfV9PYnNlcnZlcmAsIGZvcmNlVXBkYXRlKTtcblx1MDBBMCBcdTAwQTAgfVxuXG4gICAgcmVhY3Rpb25SZWYuY3VycmVudC51cGRhdGVTY2hlZHVsZXIoZm9yY2VVcGRhdGUpO1xuXG5cdTAwQTAgXHUwMEEwIHVzZUVmZmVjdCgoKSA9PiB7XG5cdTAwQTAgXHUwMEEwIFx1MDBBMCByZWFjdGlvblJlZi5jdXJyZW50LnVuZGlzcG9zZSgpO1xuXHUwMEEwIFx1MDBBMCBcdTAwQTAgcmV0dXJuICgpID0+IHJlYWN0aW9uUmVmLmN1cnJlbnQuZGlzcG9zZSgpO1xuXHUwMEEwIFx1MDBBMCB9LCBbcmVhY3Rpb25SZWYuY3VycmVudF0pO1xuXG5cdTAwQTAgXHUwMEEwIHJldHVybiByZWFjdGlvblJlZi5jdXJyZW50LnRyYWNrKCgpID0+IHtcblx1MDBBMCBcdTAwQTAgXHUwMEEwIHJldHVybiBDb21wb25lbnQocHJvcHMpO1xuXHUwMEEwIFx1MDBBMCB9KTtcblx1MDBBMCB9O1xuXG4gIEhPQ1dyYXBwZXIuZGlzcGxheU5hbWUgPSBgUmVwa2FPYnNlcnZlcigke0NvbXBvbmVudC5kaXNwbGF5TmFtZSB8fCBDb21wb25lbnQubmFtZX0pYDtcbiAgcmV0dXJuIEhPQ1dyYXBwZXI7XG59XG5cbmZ1bmN0aW9uIGlzUmVhY3RDb21wb25lbnQoYXJnOiBGdW5jdGlvbik6IGJvb2xlYW4ge1xuICByZXR1cm4gdHlwZW9mIGFyZyA9PT0gJ2Z1bmN0aW9uJyAmJiAvXltBLVpdLy50ZXN0KGFyZy5uYW1lKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlcGthSG9va0FuZEhvYyhhcmc/OiBGdW5jdGlvbiB8IHN0cmluZykge1xuICBpZiAoYXJnICYmIHR5cGVvZiBhcmcgIT09ICdzdHJpbmcnICYmIGlzUmVhY3RDb21wb25lbnQoYXJnKSkge1xuICAgIHJldHVybiBjcmVhdGVIT0NXcmFwcGVyKHRoaXMsIGFyZyBhcyBSZWFjdC5Db21wb25lbnRUeXBlKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgcmV0dXJuIHNpbXBsZUhvb2sodGhpcywgdHlwZW9mIGFyZyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbUmVwa2FdIFx1MDQxRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQzMCBcdTA0MzJcdTA0NEJcdTA0MzdcdTA0M0VcdTA0MzJcdTA0MzAgXHUwNDQ1XHUwNDQzXHUwNDNBXHUwNDMwLiBcdTA0MjNcdTA0MzFcdTA0MzVcdTA0MzRcdTA0MzhcdTA0NDJcdTA0MzVcdTA0NDFcdTA0NEMsIFx1MDQ0N1x1MDQ0Mlx1MDQzRSBzdGF0ZSgpIFx1MDQzMlx1MDQ0Qlx1MDQzN1x1MDQ0Qlx1MDQzMlx1MDQzMFx1MDQzNVx1MDQ0Mlx1MDQ0MVx1MDQ0RiBcdTA0M0RcdTA0MzAgXHUwNDMyXHUwNDM1XHUwNDQwXHUwNDQ1XHUwNDNEXHUwNDM1XHUwNDNDIFx1MDQ0M1x1MDQ0MFx1MDQzRVx1MDQzMlx1MDQzRFx1MDQzNSBcdTA0M0FcdTA0M0VcdTA0M0NcdTA0M0ZcdTA0M0VcdTA0M0RcdTA0MzVcdTA0M0RcdTA0NDJcdTA0MzAuJywgZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cbiIsICJpbXBvcnQgeyBjcmVhdGVTb3VyY2UgfSBmcm9tICdjb3JlJztcbmltcG9ydCB7IHNpbXBsZVJlYWN0UHJvdmlkZXIgfSBmcm9tICdyZWFjdC1wcm92aWRlcic7XG5pbXBvcnQgeyByZXBrYUhvb2tBbmRIb2MgfSBmcm9tICdyZWFjdC1wcm92aWRlci9ob29rQW5kSG9rJztcblxuZXhwb3J0IGNvbnN0IHJlcGthID0gPFQ+KG9iajogVCkgPT4gY3JlYXRlU291cmNlPFxuICBULCBcbiAge21haW46IHR5cGVvZiByZXBrYUhvb2tBbmRIb2MsIGdldHRlcjogdHlwZW9mIHNpbXBsZVJlYWN0UHJvdmlkZXJ9XG4+KFxuICBvYmosXG4gIHttYWluOiByZXBrYUhvb2tBbmRIb2MsIGdldHRlcjogc2ltcGxlUmVhY3RQcm92aWRlcn1cbik7XG5cbmV4cG9ydCB7IHdhdGNoIH0gZnJvbSAnd2F0Y2hlcic7XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPTyxJQUFNLFdBQU4sTUFBZTtBQUFBLEVBTXBCLFlBQVksTUFBYyxXQUF1QjtBQUhqRCxTQUFRLGVBQWUsb0JBQUksSUFBd0I7QUFDbkQsU0FBUSxhQUFhO0FBZ0NyQixTQUFRLFdBQVcsQ0FBQyxnQkFBd0I7QUFDMUMsY0FBUSxJQUFJ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
