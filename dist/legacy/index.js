import{b as n}from"../chunks/KFMMTQSC.chunk.js";var $=class extends Function{constructor(){super();let e;return e=(...t)=>e.__call(...t),Object.setPrototypeOf(e,new.target.prototype)}},c="__PROVIDER_ID__",i="__REPO__",I=(r,e)=>(r[`${i}muppet`][c]&&e!==r[`${i}muppet`][c]&&typeof e=="string"&&!e.startsWith(i)&&(r[`${i}muppet`][r[`${i}muppet`][c]]=!1,r[`${i}criticalFields`][r[`${i}muppet`][c]]=[...new Set([...r[`${i}criticalFields`][r[`${i}muppet`][c]]||[],e])]),typeof e=="string"&&e.startsWith(i)||e==="__call"?r[e]:r[`${i}data`][e]),k=(r,e,t)=>typeof e=="string"&&e.startsWith(i)||e==="__call"?(r[e]=t,!0):(r[`${i}data`]={...r[`${i}data`],[e]:t},r[`${i}listeners`][e]&&r[`${i}listeners`][e].size&&r[`${i}listeners`][e].forEach((s,o)=>{r[`${i}muppet`][o]!==void 0&&r[`${i}muppet`][o]===!1&&(r[`${i}muppet`][o]=!0),s()}),r[`${i}onUpdate`].length&&r[`${i}onUpdate`].forEach(s=>s&&s(e)),!0),b=(r,e,t)=>{try{let s=function(){return e?[this,e]:this},o=new $;e&&(o[`${i}methods`]=e),o[`${i}onUpdate`]=[],o[`${i}data`]=r,o[`${i}criticalFields`]={},o[`${i}muppet`]={},o[`${i}listeners`]=Object.keys(r).reduce((d,l)=>({...d,[l]:new Map}),{});let a=new Proxy(o,{set:k,get:I});return o.__call=(t||s).bind(a),a}catch(s){console.error("SOURCE OBJECT ERROR: ",s)}};var O=class{constructor(){this.SPECIAL_KEY=c}init(e,t={}){typeof e=="object"&&!Array.isArray(e)&&(t.provider&&(this.savedProvider=t.provider),this.sourceObj=b(e,t.methods,t.provider||this.savedProvider)),t.broadcastName&&this.createBroadcast(t.broadcastName)}createBroadcast(e="broadcastWatcher"){this.broadcast=new BroadcastChannel(e),this.broadcast.onmessage=({data:t})=>{if(t==="needSome")this.broadcast.postMessage({data:this.get()});else if(t.type===void 0)for(let s in t.data)this.sourceObj[s]=t.data[s]},this.broadcast.postMessage("needSome")}set(e,t,s=!1){this.sourceObj&&(this.sourceObj[e]=t),this.broadcast&&!s&&this.broadcast.postMessage({type:e,data:t})}get(e){if(this.sourceObj&&e)return this.sourceObj[e];if(!e)return this.sourceObj[`${i}data`]}watch(e){let t=this.sourceObj[`${i}onUpdate`].length;return new Promise(s=>{this.sourceObj[`${i}onUpdate`]=[...this.sourceObj[`${i}onUpdate`],o=>{e===o&&(s(this.sourceObj[e]),this.sourceObj[`${i}onUpdate`][t]=null,this.sourceObj[`${i}onUpdate`].every(a=>a===null)&&(this.sourceObj[`${i}onUpdate`]=[]))}]})}watchFor(e,t){let s=this.sourceObj[`${i}onUpdate`].length;return new Promise(o=>{this.sourceObj[`${i}onUpdate`]=[...this.sourceObj[`${i}onUpdate`],a=>{e===a&&this.sourceObj[e]===t&&(o(this.sourceObj[e]),this.sourceObj[`${i}onUpdate`][s]=null,this.sourceObj[`${i}onUpdate`].every(d=>d===null)&&(this.sourceObj[`${i}onUpdate`]=[]))}]})}},g=(r,e,t,s)=>{let o=new O;return o.init(r,{provider:e,methods:t,broadcastName:s}),o};var u=class extends Function{initializeState(e,t){}constructor(){super();let e;return e=(...t)=>e.__call(...t),Object.setPrototypeOf(e,new.target.prototype)}},p=function(r,e={}){let s=Object.keys(r||{}).reduce((o,a)=>{let d;return e.prevActions!==void 0&&e.prevActions.get(a)!==void 0?d=e.prevActions.get(a):r&&(d=r[a]),{...o,[a]:d}},r||{});return g(s,e.provider,e.methods)},M=function(r,e={}){e.prevActions||(e.prevActions=this?.actions),e.provider||(e.provider=this?.actions?.savedProvider);let t=p.call(this,r,e);this.actions=t};function w(r){let e=[],t=r;do e.push(...Object.getOwnPropertyNames(t));while(t=Object.getPrototypeOf(t));return e.sort().filter((s,o,a)=>{if(s!=a[o+1]&&typeof r[s]=="function")return!0})}function R(r,e,{provider:t}={}){let s,o=null;if(e){s=w(e).reduce((l,T)=>T!=="constructor"&&typeof e[T]=="function"?{...l,[T]:e[T].bind(e)}:l,{});let d=e.repo?.actions;e.repo=new u,e.repo.initRepository=p,e.repo.initializeState=M,e.repo.initializeState(d?{...d.get(),...r}:r,{methods:s,prevActions:d,provider:t||d?.savedProvider||this?.actions?.savedProvider})}else o=p(r,{provider:t||this?.actions?.savedProvider,methods:s});return(o||e?.repo?.actions||{}).sourceObj}import y from"react";function _(r){let e,t=y.useId?y.useId():y.useRef(parseInt(String(Math.random()*1e7),10).toString()).current;y.useId&&(e=y.useSyncExternalStore);let s=e(o=>(this[`${n}criticalFields`][t]&&this[`${n}criticalFields`][t].forEach(a=>{this[`${n}listeners`][a]&&typeof this[`${n}listeners`][a]!="function"&&this[`${n}listeners`][a].set(t,o)}),()=>{this[`${n}criticalFields`][t]&&(this[`${n}muppet`][t]=!1,this[`${n}criticalFields`][t].forEach(a=>{this[`${n}listeners`][a]&&typeof this[`${n}listeners`][a]!="function"&&this[`${n}listeners`][a].delete(t)}))}),()=>(this[`${n}muppet`].__PROVIDER_ID__=t,this[`${n}muppet`][t]===!0?(this[`${n}muppet`].__PROVIDER_ID__=void 0,this[`${n}data`]):this));return y.useEffect(()=>()=>{this[`${n}muppet`][t]&&this[`${n}criticalFields`][t]&&(this[`${n}criticalFields`][t].forEach(o=>{this[`${n}listeners`][o]&&typeof this[`${n}listeners`][o]!="function"&&this[`${n}listeners`][o].delete(t)}),delete this[`${n}criticalFields`][t],delete this[`${n}muppet`][t])},[]),r!==void 0?s[r]:[s,this[`${n}methods`]]}var m=new u;m.initRepository=p;m.initializeState=M;m.actions=p({},{provider:_});m.__call=R;export{m as repka};
