import{b as n}from"../chunks/KFMMTQSC.chunk.js";var $=class extends Function{constructor(){super();let e;return e=(...t)=>e.__call(...t),Object.setPrototypeOf(e,new.target.prototype)}},c="__PROVIDER_ID__",o="__REPO__",I=(r,e)=>(r[`${o}muppet`][c]&&e!==r[`${o}muppet`][c]&&typeof e=="string"&&!e.startsWith(o)&&(r[`${o}muppet`][r[`${o}muppet`][c]]=!1,r[`${o}criticalFields`][r[`${o}muppet`][c]]=[...new Set([...r[`${o}criticalFields`][r[`${o}muppet`][c]]||[],e])]),typeof e=="string"&&e.startsWith(o)||e==="__call"?r[e]:r[`${o}data`][e]),k=(r,e,t)=>typeof e=="string"&&e.startsWith(o)||e==="__call"?(r[e]=t,!0):(r[`${o}data`]={...r[`${o}data`],[e]:t},r[`${o}listeners`][e]&&r[`${o}listeners`][e].size&&r[`${o}listeners`][e].forEach((s,i)=>{r[`${o}muppet`][i]!==void 0&&r[`${o}muppet`][i]===!1&&(r[`${o}muppet`][i]=!0),s()}),r[`${o}onUpdate`].length&&r[`${o}onUpdate`].forEach(s=>s&&s(e)),!0),b=(r,e,t)=>{try{let s=function(){return e?[this,e]:this},i=new $;e&&(i[`${o}methods`]=e),i[`${o}onUpdate`]=[],i[`${o}data`]=r,i[`${o}criticalFields`]={},i[`${o}muppet`]={},i[`${o}listeners`]=Object.keys(r).reduce((d,l)=>({...d,[l]:new Map}),{});let a=new Proxy(i,{set:k,get:I});return i.__call=(t||s).bind(a),a}catch{}};var O=class{constructor(){this.SPECIAL_KEY=c}init(e,t={}){typeof e=="object"&&!Array.isArray(e)&&(t.provider&&(this.savedProvider=t.provider),this.sourceObj=b(e,t.methods,t.provider||this.savedProvider)),t.broadcastName&&this.createBroadcast(t.broadcastName)}createBroadcast(e="broadcastWatcher"){this.broadcast=new BroadcastChannel(e),this.broadcast.onmessage=({data:t})=>{if(t==="needSome")this.broadcast.postMessage({data:this.get()});else if(t.type===void 0)for(let s in t.data)this.sourceObj[s]=t.data[s]},this.broadcast.postMessage("needSome")}set(e,t,s=!1){this.sourceObj&&(this.sourceObj[e]=t),this.broadcast&&!s&&this.broadcast.postMessage({type:e,data:t})}get(e){if(this.sourceObj&&e)return this.sourceObj[e];if(!e)return this.sourceObj[`${o}data`]}watch(e){let t=this.sourceObj[`${o}onUpdate`].length;return new Promise(s=>{this.sourceObj[`${o}onUpdate`]=[...this.sourceObj[`${o}onUpdate`],i=>{e===i&&(s(this.sourceObj[e]),this.sourceObj[`${o}onUpdate`][t]=null,this.sourceObj[`${o}onUpdate`].every(a=>a===null)&&(this.sourceObj[`${o}onUpdate`]=[]))}]})}watchFor(e,t){let s=this.sourceObj[`${o}onUpdate`].length;return new Promise(i=>{this.sourceObj[`${o}onUpdate`]=[...this.sourceObj[`${o}onUpdate`],a=>{e===a&&this.sourceObj[e]===t&&(i(this.sourceObj[e]),this.sourceObj[`${o}onUpdate`][s]=null,this.sourceObj[`${o}onUpdate`].every(d=>d===null)&&(this.sourceObj[`${o}onUpdate`]=[]))}]})}},g=(r,e,t,s)=>{let i=new O;return i.init(r,{provider:e,methods:t,broadcastName:s}),i};var u=class extends Function{initializeState(e,t){}constructor(){super();let e;return e=(...t)=>e.__call(...t),Object.setPrototypeOf(e,new.target.prototype)}},p=function(r,e={}){let s=Object.keys(r||{}).reduce((i,a)=>{let d;return e.prevActions!==void 0&&e.prevActions.get(a)!==void 0?d=e.prevActions.get(a):r&&(d=r[a]),{...i,[a]:d}},r||{});return g(s,e.provider,e.methods)},M=function(r,e={}){e.prevActions||(e.prevActions=this?.actions),e.provider||(e.provider=this?.actions?.savedProvider);let t=p.call(this,r,e);this.actions=t};function w(r){let e=[],t=r;do e.push(...Object.getOwnPropertyNames(t));while(t=Object.getPrototypeOf(t));return e.sort().filter((s,i,a)=>{if(s!=a[i+1]&&typeof r[s]=="function")return!0})}function R(r,e,{provider:t}={}){let s,i=null;if(e){s=w(e).reduce((l,T)=>T!=="constructor"&&typeof e[T]=="function"?{...l,[T]:e[T].bind(e)}:l,{});let d=e.repo?.actions;e.repo=new u,e.repo.initRepository=p,e.repo.initializeState=M,e.repo.initializeState(d?{...d.get(),...r}:r,{methods:s,prevActions:d,provider:t||d?.savedProvider||this?.actions?.savedProvider})}else i=p(r,{provider:t||this?.actions?.savedProvider,methods:s});return(i||e?.repo?.actions||{}).sourceObj}import y from"react";function _(r){let e,t=y.useId?y.useId():y.useRef(parseInt(String(Math.random()*1e7),10).toString()).current;y.useId&&(e=y.useSyncExternalStore);let s=e(i=>(this[`${n}criticalFields`][t]&&this[`${n}criticalFields`][t].forEach(a=>{this[`${n}listeners`][a]&&typeof this[`${n}listeners`][a]!="function"&&this[`${n}listeners`][a].set(t,i)}),()=>{this[`${n}criticalFields`][t]&&(this[`${n}muppet`][t]=!1,this[`${n}criticalFields`][t].forEach(a=>{this[`${n}listeners`][a]&&typeof this[`${n}listeners`][a]!="function"&&this[`${n}listeners`][a].delete(t)}))}),()=>(this[`${n}muppet`].__PROVIDER_ID__=t,this[`${n}muppet`][t]===!0?(this[`${n}muppet`].__PROVIDER_ID__=void 0,this[`${n}data`]):this));return y.useEffect(()=>()=>{this[`${n}muppet`][t]&&this[`${n}criticalFields`][t]&&(this[`${n}criticalFields`][t].forEach(i=>{this[`${n}listeners`][i]&&typeof this[`${n}listeners`][i]!="function"&&this[`${n}listeners`][i].delete(t)}),delete this[`${n}criticalFields`][t],delete this[`${n}muppet`][t])},[]),r!==void 0?s[r]:[s,this[`${n}methods`]]}var m=new u;m.initRepository=p;m.initializeState=M;m.actions=p({},{provider:_});m.__call=R;export{m as repka};
