{
  "version": 3,
  "sources": ["../../packages/core/index.ts"],
  "sourcesContent": ["export type providerType<DataType = undefined, MethodsObjType = undefined> = () => \n  (MethodsObjType extends object ? [DataType, MethodsObjType] : DataType);\n\nexport class Callable extends Function {\n  __call: Function\n  constructor() {\n    super();\n    let closure = undefined;\n    closure = (...args) => { \n      return closure.__call(...args); \n    };\n    return Object.setPrototypeOf(closure, new.target.prototype);\n  }\n}\n\nexport const SPECIAL_KEY = '__PROVIDER_ID__';\nexport const FIELDS_PREFIX = '__REPO__'\n\nconst get = (obj, prop) => {\n  if (\n    obj[`${FIELDS_PREFIX}muppet`][SPECIAL_KEY] \n    && prop !== obj[`${FIELDS_PREFIX}muppet`][SPECIAL_KEY]\n    && (typeof prop === 'string' && !prop.startsWith(FIELDS_PREFIX)) \n  ) {\n    obj[`${FIELDS_PREFIX}muppet`][obj[`${FIELDS_PREFIX}muppet`][SPECIAL_KEY]] = false;\n    obj[`${FIELDS_PREFIX}criticalFields`][obj[`${FIELDS_PREFIX}muppet`][SPECIAL_KEY]] = [...new Set([\n      ...(obj[`${FIELDS_PREFIX}criticalFields`][obj[`${FIELDS_PREFIX}muppet`][SPECIAL_KEY]] || []),\n      prop\n    ])];\n  }\n  if ((typeof prop === 'string' && prop.startsWith(FIELDS_PREFIX)) || prop === '__call') {\n    return obj[prop]\n  }\n\n  return obj[`${FIELDS_PREFIX}data`][prop];\n}\n\nconst set = (obj, prop, value): boolean => {\n  if ((typeof prop === 'string' && prop.startsWith(FIELDS_PREFIX)) || prop === '__call') {\n    obj[prop] = value;\n    return true;\n  } \n\n  obj[`${FIELDS_PREFIX}data`] = {\n    ...obj[`${FIELDS_PREFIX}data`],\n    [prop]: value\n  };\n\n  if (obj[`${FIELDS_PREFIX}listeners`][prop] && obj[`${FIELDS_PREFIX}listeners`][prop].size) {\n    obj[`${FIELDS_PREFIX}listeners`][prop].forEach((notify, key) => {\n      if (obj[`${FIELDS_PREFIX}muppet`][key] !== undefined \n        && obj[`${FIELDS_PREFIX}muppet`][key] === false) { \n        obj[`${FIELDS_PREFIX}muppet`][key] = true; \n      }\n\n      notify();\n    });\n  }\n  if (obj[`${FIELDS_PREFIX}onUpdate`].length) {\n    obj[`${FIELDS_PREFIX}onUpdate`].forEach((fn: (...args: unknown[]) => void) => fn && fn(prop));\n  }\n\n  return true;\n}\n\nexport interface ISource<T> {\n  <\n    DataType = T,\n    MethodsObjType = undefined\n  >(\n    data: DataType,\n    methods?: MethodsObjType,\n    provider?: providerType<DataType, MethodsObjType>,\n  ): (() => [DataType, Omit<MethodsObjType, 'repo'>]) & DataType;\n}\n\nexport const createSource = <\n  DataType = unknown,\n  MethodsObjType = undefined\n>(\n  data: DataType,\n  methods?: MethodsObjType,\n  provider?: providerType<DataType, MethodsObjType>,\n): ISource<DataType> => {\n  try {\n    function defaultProvider() {\n      return methods ? [this, methods] : this;\n    };\n    const callableObj = new Callable();\n\n    if (methods) callableObj[`${FIELDS_PREFIX}methods`] = methods;\n\n    callableObj[`${FIELDS_PREFIX}onUpdate`] = [];\n    callableObj[`${FIELDS_PREFIX}data`] = data;\n    callableObj[`${FIELDS_PREFIX}criticalFields`] = {};\n    callableObj[`${FIELDS_PREFIX}muppet`] = {};\n    callableObj[`${FIELDS_PREFIX}listeners`] = Object.keys(data).reduce(\n      (prev, key) => ({ ...prev, [key]: new Map() }), {}\n    );\n\n    const proxy = new Proxy(callableObj, { set, get });\n    callableObj.__call = (provider || defaultProvider).bind(proxy);\n\n    return proxy;\n  } catch (error) {\n    console.error('SOURCE OBJECT ERROR: ', error);\n  }\n};\n"],
  "mappings": ";AAGO,IAAM,WAAN,cAAuB,SAAS;AAAA,EAErC,cAAc;AACZ,UAAM;AACN,QAAI,UAAU;AACd,cAAU,IAAI,SAAS;AACrB,aAAO,QAAQ,OAAO,GAAG,IAAI;AAAA,IAC/B;AACA,WAAO,OAAO,eAAe,SAAS,WAAW,SAAS;AAAA,EAC5D;AACF;AAEO,IAAM,cAAc;AACpB,IAAM,gBAAgB;AAE7B,IAAM,MAAM,CAAC,KAAK,SAAS;AACzB,MACE,IAAI,GAAG,aAAa,QAAQ,EAAE,WAAW,KACtC,SAAS,IAAI,GAAG,aAAa,QAAQ,EAAE,WAAW,MACjD,OAAO,SAAS,YAAY,CAAC,KAAK,WAAW,aAAa,IAC9D;AACA,QAAI,GAAG,aAAa,QAAQ,EAAE,IAAI,GAAG,aAAa,QAAQ,EAAE,WAAW,CAAC,IAAI;AAC5E,QAAI,GAAG,aAAa,gBAAgB,EAAE,IAAI,GAAG,aAAa,QAAQ,EAAE,WAAW,CAAC,IAAI,CAAC,GAAG,oBAAI,IAAI;AAAA,MAC9F,GAAI,IAAI,GAAG,aAAa,gBAAgB,EAAE,IAAI,GAAG,aAAa,QAAQ,EAAE,WAAW,CAAC,KAAK,CAAC;AAAA,MAC1F;AAAA,IACF,CAAC,CAAC;AAAA,EACJ;AACA,MAAK,OAAO,SAAS,YAAY,KAAK,WAAW,aAAa,KAAM,SAAS,UAAU;AACrF,WAAO,IAAI,IAAI;AAAA,EACjB;AAEA,SAAO,IAAI,GAAG,aAAa,MAAM,EAAE,IAAI;AACzC;AAEA,IAAM,MAAM,CAAC,KAAK,MAAM,UAAmB;AACzC,MAAK,OAAO,SAAS,YAAY,KAAK,WAAW,aAAa,KAAM,SAAS,UAAU;AACrF,QAAI,IAAI,IAAI;AACZ,WAAO;AAAA,EACT;AAEA,MAAI,GAAG,aAAa,MAAM,IAAI;AAAA,IAC5B,GAAG,IAAI,GAAG,aAAa,MAAM;AAAA,IAC7B,CAAC,IAAI,GAAG;AAAA,EACV;AAEA,MAAI,IAAI,GAAG,aAAa,WAAW,EAAE,IAAI,KAAK,IAAI,GAAG,aAAa,WAAW,EAAE,IAAI,EAAE,MAAM;AACzF,QAAI,GAAG,aAAa,WAAW,EAAE,IAAI,EAAE,QAAQ,CAAC,QAAQ,QAAQ;AAC9D,UAAI,IAAI,GAAG,aAAa,QAAQ,EAAE,GAAG,MAAM,UACtC,IAAI,GAAG,aAAa,QAAQ,EAAE,GAAG,MAAM,OAAO;AACjD,YAAI,GAAG,aAAa,QAAQ,EAAE,GAAG,IAAI;AAAA,MACvC;AAEA,aAAO;AAAA,IACT,CAAC;AAAA,EACH;AACA,MAAI,IAAI,GAAG,aAAa,UAAU,EAAE,QAAQ;AAC1C,QAAI,GAAG,aAAa,UAAU,EAAE,QAAQ,CAAC,OAAqC,MAAM,GAAG,IAAI,CAAC;AAAA,EAC9F;AAEA,SAAO;AACT;AAaO,IAAM,eAAe,CAI1B,MACA,SACA,aACsB;AACtB,MAAI;AACF,QAAS,kBAAT,WAA2B;AACzB,aAAO,UAAU,CAAC,MAAM,OAAO,IAAI;AAAA,IACrC;AAAC;AACD,UAAM,cAAc,IAAI,SAAS;AAEjC,QAAI;AAAS,kBAAY,GAAG,aAAa,SAAS,IAAI;AAEtD,gBAAY,GAAG,aAAa,UAAU,IAAI,CAAC;AAC3C,gBAAY,GAAG,aAAa,MAAM,IAAI;AACtC,gBAAY,GAAG,aAAa,gBAAgB,IAAI,CAAC;AACjD,gBAAY,GAAG,aAAa,QAAQ,IAAI,CAAC;AACzC,gBAAY,GAAG,aAAa,WAAW,IAAI,OAAO,KAAK,IAAI,EAAE;AAAA,MAC3D,CAAC,MAAM,SAAS,EAAE,GAAG,MAAM,CAAC,GAAG,GAAG,oBAAI,IAAI,EAAE;AAAA,MAAI,CAAC;AAAA,IACnD;AAEA,UAAM,QAAQ,IAAI,MAAM,aAAa,EAAE,KAAK,IAAI,CAAC;AACjD,gBAAY,UAAU,YAAY,iBAAiB,KAAK,KAAK;AAE7D,WAAO;AAAA,EACT,SAAS,OAAO;AACd,YAAQ,MAAM,yBAAyB,KAAK;AAAA,EAC9C;AACF;",
  "names": []
}
