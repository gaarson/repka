import {
  REACTION_STACK
} from "./HVJOCNRK.chunk.js";
import {
  FIELDS_PREFIX
} from "./GWKM27VZ.chunk.js";

// packages/react-provider/stringHash.ts
function simpleHash(str) {
  let hash = 5381;
  for (let i = 0; i < str.length; i++) {
    hash = (hash << 5) + hash + str.charCodeAt(i);
  }
  return String(hash);
}

// packages/react-provider/getComponentName.ts
import React from "react";
function getRenderingComponentName() {
  const fallback = "UnknownComponent";
  try {
    const internals = React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;
    if (!internals) return fallback;
    const owner = internals.ReactCurrentOwner?.current;
    if (!owner) return fallback;
    const componentType = owner.type;
    if (!componentType) return fallback;
    return componentType.displayName || componentType.name || fallback;
  } catch (e) {
    return fallback;
  }
}

// packages/react-provider/spamHash.ts
import React2 from "react";
var KNOWN_SPAM_HASH = null;
var BrokenComponent = () => {
  React2.useEffect(() => {
    React2.useState();
  }, []);
  return null;
};
var cleanErrorMessage = (message) => {
  let str = message.toString();
  str = str.replace(/^(Uncaught )?Error: /, "");
  return str;
};
(async () => {
  const isServer = typeof window === "undefined";
  try {
    if (isServer) {
      const { renderToString } = await import("react-dom/server");
      const originalConsoleError = console.error;
      console.error = () => {
      };
      try {
        renderToString(React2.createElement(BrokenComponent));
      } catch (error) {
        const cleanMessage = cleanErrorMessage(error.message);
        KNOWN_SPAM_HASH = simpleHash(cleanMessage.substring(0, 200));
      } finally {
        console.error = originalConsoleError;
      }
    } else {
      const runClientCheck = async () => {
        try {
          const { createRoot } = await import("react-dom/client");
          const tempDiv = document.createElement("div");
          tempDiv.id = "react-error-test-rig";
          tempDiv.style.display = "none";
          document.body.appendChild(tempDiv);
          const root = createRoot(tempDiv);
          const originalConsoleError = console.error;
          const originalOnError = window.onerror;
          const originalOnUnhandledRejection = window.onunhandledrejection;
          window.__IS_REACT_SPAM_TEST__ = false;
          const cleanup = () => {
            setTimeout(() => {
              window.__IS_REACT_SPAM_TEST__ = false;
              window.removeEventListener("error", errorListener, { capture: true });
              window.removeEventListener("unhandledrejection", rejectionListener, { capture: true });
              console.error = originalConsoleError;
              window.onerror = originalOnError;
              window.onunhandledrejection = originalOnUnhandledRejection;
              try {
                root.unmount();
                tempDiv.remove();
              } catch (e) {
              }
            }, 0);
          };
          const errorListener = (event) => {
            if (!window.__IS_REACT_SPAM_TEST__) {
              return;
            }
            const cleanMessage = cleanErrorMessage(event.message);
            const isTheSpamError = cleanMessage.includes("Invalid hook call") || // для dev
            cleanMessage.includes("Minified React error #321");
            if (isTheSpamError) {
              const hash = simpleHash(cleanMessage.substring(0, 200));
              KNOWN_SPAM_HASH = hash;
              event.preventDefault();
              event.stopImmediatePropagation();
              event.stopPropagation();
              cleanup();
              return false;
            }
          };
          const rejectionListener = (event) => {
            if (!window.__IS_REACT_SPAM_TEST__) {
              return;
            }
            const reason = event.reason?.message || event.reason?.toString() || "";
            const cleanMessage = cleanErrorMessage(reason);
            const isTheSpamError = cleanMessage.includes("Invalid hook call") || // dev
            cleanMessage.includes("Minified React error #321");
            if (isTheSpamError) {
              const hash = simpleHash(cleanMessage.substring(0, 200));
              KNOWN_SPAM_HASH = hash;
              event.preventDefault();
              event.stopImmediatePropagation();
              event.stopPropagation();
              cleanup();
            }
          };
          window.addEventListener("error", errorListener, { capture: true });
          window.addEventListener("unhandledrejection", rejectionListener, { capture: true });
          console.error = () => {
          };
          window.onerror = function(message) {
            if (window.__IS_REACT_SPAM_TEST__) {
              return true;
            }
            return originalOnError ? originalOnError.apply(window, arguments) : false;
          };
          window.onunhandledrejection = (event) => {
            if (window.__IS_REACT_SPAM_TEST__) {
              return true;
            }
            return originalOnUnhandledRejection ? originalOnUnhandledRejection.apply(window, [event]) : false;
          };
          window.__IS_REACT_SPAM_TEST__ = true;
          root.render(React2.createElement(BrokenComponent));
        } catch (e) {
          if (window.originalConsoleError) {
            console.error = window.originalConsoleError;
          }
          if (window.originalOnError) {
            window.onerror = window.originalOnError;
          }
          if (window.originalOnUnhandledRejection) {
            window.onunhandledrejection = window.originalOnUnhandledRejection;
          }
          console.error(`[SPAM HASH SCRIPT] \u041A\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 (\u0432\u043D\u0443\u0442\u0440\u0438 runClientCheck):`, e);
        }
      };
      setTimeout(runClientCheck, 0);
    }
  } catch (e) {
    console.error(`[SPAM HASH SCRIPT] \u041A\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 (\u0432\u043D\u0435\u0448\u043D\u0438\u0439 IIFE):`, e);
  }
})();

// packages/react-provider/index.ts
import React3 from "react";
function createRepkaError(originalError, componentName, spamHash, errorHash) {
  const isError = originalError instanceof Error;
  const message = isError ? originalError.message : String(originalError);
  const repkaError = new Error(
    `[Repka CRITICAL ERROR in <${componentName}>] 

Repka's magic getter (store.prop) caught an UNKNOWN React error. 
This is NOT the expected 'Invalid hook call' spam. 
(Known Spam Hash: ${spamHash}, This Error Hash: ${errorHash}) 

This is likely a CRITICAL React error (e.g., 'Rendered more hooks...'). 
Repka is crashing LOUDLY to prevent a "zombie component". 

Original error: 
> ${message}`
  );
  repkaError.cause = originalError;
  return repkaError;
}
var simpleHook = (context, prop) => {
  const useSync = React3.useSyncExternalStore;
  if (!useSync) {
    return context[`${FIELDS_PREFIX}data`][prop];
  }
  const state = useSync(
    (notify) => {
      try {
        const currentProp = prop;
        if (context[`${FIELDS_PREFIX}listeners`][currentProp] && typeof context[`${FIELDS_PREFIX}listeners`][currentProp].set === "function") {
          context[`${FIELDS_PREFIX}listeners`][currentProp].set(notify, notify);
        }
        if (context[`${FIELDS_PREFIX}criticalFields`] && typeof context[`${FIELDS_PREFIX}criticalFields`].set === "function") {
          context[`${FIELDS_PREFIX}criticalFields`].set(notify, [currentProp]);
        }
        if (context[`${FIELDS_PREFIX}muppet`] && typeof context[`${FIELDS_PREFIX}muppet`].set === "function") {
          context[`${FIELDS_PREFIX}muppet`].set(notify, true);
        }
      } catch (err) {
        console.error("Error during subscribe:", err, prop);
      }
      return () => {
        try {
          context[`${FIELDS_PREFIX}muppet`]?.set(notify, false);
          const fields = context[`${FIELDS_PREFIX}criticalFields`]?.get(notify);
          if (fields) {
            fields.forEach((p) => {
              context[`${FIELDS_PREFIX}listeners`][p]?.delete(notify);
            });
          }
          context[`${FIELDS_PREFIX}criticalFields`]?.delete(notify);
          context[`${FIELDS_PREFIX}muppet`]?.delete(notify);
        } catch (err) {
          console.error("Error during unsubscribe:", err);
        }
      };
    },
    () => {
      try {
        return context[`${FIELDS_PREFIX}data`];
      } catch (error) {
        return {};
      }
    },
    () => {
      try {
        return context[`${FIELDS_PREFIX}data`];
      } catch (error) {
        return {};
      }
    }
  );
  return state ? state[prop] : context[`${FIELDS_PREFIX}data`][prop];
};
function simpleReactProvider(prop) {
  const currentReaction = REACTION_STACK[REACTION_STACK.length - 1];
  if (currentReaction) {
    currentReaction.reportDependency(this, prop);
    return this[`${FIELDS_PREFIX}data`][prop];
  }
  let isInReactRender = false;
  if (React3.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE) {
    if (React3.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE?.H !== null) {
      isInReactRender = true;
    }
  } else if (React3?.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED?.ReactCurrentDispatcher?.current) {
    isInReactRender = true;
  }
  if (!isInReactRender) {
    return this[`${FIELDS_PREFIX}data`][prop];
  }
  try {
    return simpleHook(this, prop);
  } catch (e) {
    if (!(e instanceof Error)) {
      throw e;
    }
    const messageToHash = e.message.substring(0, 200);
    const messageHash = simpleHash(messageToHash);
    console.log(messageHash, KNOWN_SPAM_HASH, e.message);
    if (KNOWN_SPAM_HASH && messageHash === KNOWN_SPAM_HASH) {
      return this[`${FIELDS_PREFIX}data`][prop];
    }
    const componentName = getRenderingComponentName();
    throw createRepkaError(e, componentName, KNOWN_SPAM_HASH, messageHash);
  }
}

export {
  createRepkaError,
  simpleHook,
  simpleReactProvider
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vcGFja2FnZXMvcmVhY3QtcHJvdmlkZXIvc3RyaW5nSGFzaC50cyIsICIuLi8uLi9wYWNrYWdlcy9yZWFjdC1wcm92aWRlci9nZXRDb21wb25lbnROYW1lLnRzIiwgIi4uLy4uL3BhY2thZ2VzL3JlYWN0LXByb3ZpZGVyL3NwYW1IYXNoLnRzIiwgIi4uLy4uL3BhY2thZ2VzL3JlYWN0LXByb3ZpZGVyL2luZGV4LnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJleHBvcnQgZnVuY3Rpb24gc2ltcGxlSGFzaChzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCBoYXNoID0gNTM4MTsgLy8gXHUwNDIxXHUwNDQyXHUwNDMwXHUwNDQwXHUwNDQyXHUwNDNFXHUwNDMyXHUwNDNFXHUwNDM1IFwiXHUwNDNDXHUwNDMwXHUwNDMzXHUwNDM4XHUwNDQ3XHUwNDM1XHUwNDQxXHUwNDNBXHUwNDNFXHUwNDM1XCIgXHUwNDQ3XHUwNDM4XHUwNDQxXHUwNDNCXHUwNDNFXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgaGFzaCA9ICgoaGFzaCA8PCA1KSArIGhhc2gpICsgc3RyLmNoYXJDb2RlQXQoaSk7IC8qIGhhc2ggKiAzMyArIGMgKi9cbiAgfVxuICByZXR1cm4gU3RyaW5nKGhhc2gpO1xufVxuIiwgImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5cbi8qKlxuICogXHUwNDE4XHUwNDQxXHUwNDNGXHUwNDNFXHUwNDNCXHUwNDRDXHUwNDM3XHUwNDQzXHUwNDM1XHUwNDQyIFJlYWN0IEludGVybmFscyBcdTA0MzRcdTA0M0JcdTA0NEYgXHUwNDNGXHUwNDNFXHUwNDNCXHUwNDQzXHUwNDQ3XHUwNDM1XHUwNDNEXHUwNDM4XHUwNDRGIFx1MDQzOFx1MDQzQ1x1MDQzNVx1MDQzRFx1MDQzOCBcdTA0M0FcdTA0M0VcdTA0M0NcdTA0M0ZcdTA0M0VcdTA0M0RcdTA0MzVcdTA0M0RcdTA0NDJcdTA0MzAsXG4gKiBcdTA0M0FcdTA0M0VcdTA0NDJcdTA0M0VcdTA0NDBcdTA0NEJcdTA0MzkgXHUwNDQxXHUwNDM1XHUwNDM5XHUwNDQ3XHUwNDMwXHUwNDQxIFx1MDQ0MFx1MDQzNVx1MDQzRFx1MDQzNFx1MDQzNVx1MDQ0MFx1MDQzOFx1MDQ0Mlx1MDQ0MVx1MDQ0Ri5cbiAqIFx1MDQyRFx1MDQ0Mlx1MDQzRSBcIlx1MDQ0N1x1MDQzNVx1MDQ0MFx1MDQzRFx1MDQzMFx1MDQ0RiBcdTA0M0NcdTA0MzBcdTA0NDJcdTA0MzVcdTA0NDBcdTA0MzhcdTA0NEZcIiBcdTIwMTMgXHUwNDQ1XHUwNDQwXHUwNDQzXHUwNDNGXHUwNDNBXHUwNDNFLCBcdTA0M0RcdTA0M0UgXHUwNDNEXHUwNDM1XHUwNDNFXHUwNDMxXHUwNDQ1XHUwNDNFXHUwNDM0XHUwNDM4XHUwNDNDXHUwNDNFIFx1MDQzNFx1MDQzQlx1MDQ0RiBcdTA0M0VcdTA0MzFcdTA0M0VcdTA0MzNcdTA0MzBcdTA0NDlcdTA0MzVcdTA0M0RcdTA0MzhcdTA0NEYgXHUwNDNFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNFXHUwNDNBLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVuZGVyaW5nQ29tcG9uZW50TmFtZSgpOiBzdHJpbmcge1xuICBjb25zdCBmYWxsYmFjayA9ICdVbmtub3duQ29tcG9uZW50JztcbiAgdHJ5IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgaW50ZXJuYWxzID0gUmVhY3QuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQ7XG4gICAgaWYgKCFpbnRlcm5hbHMpIHJldHVybiBmYWxsYmFjaztcbiAgICBjb25zdCBvd25lciA9IGludGVybmFscy5SZWFjdEN1cnJlbnRPd25lcj8uY3VycmVudDtcbiAgICBpZiAoIW93bmVyKSByZXR1cm4gZmFsbGJhY2s7XG4gICAgY29uc3QgY29tcG9uZW50VHlwZSA9IG93bmVyLnR5cGU7XG4gICAgaWYgKCFjb21wb25lbnRUeXBlKSByZXR1cm4gZmFsbGJhY2s7XG5cbiAgICAvLyAubmFtZSBcdTA0MzRcdTA0M0JcdTA0NEYgZnVuY3Rpb24tXHUwNDNBXHUwNDNFXHUwNDNDXHUwNDNGXHUwNDNFXHUwNDNEXHUwNDM1XHUwNDNEXHUwNDQyXHUwNDNFXHUwNDMyLCAuZGlzcGxheU5hbWUgXHUwNDM0XHUwNDNCXHUwNDRGIFJlYWN0Lm1lbW8gXHUwNDM4IFx1MDQ0Mi5cdTA0MzQuXG4gICAgcmV0dXJuIGNvbXBvbmVudFR5cGUuZGlzcGxheU5hbWUgfHwgY29tcG9uZW50VHlwZS5uYW1lIHx8IGZhbGxiYWNrO1xuICB9IGNhdGNoIChlKSB7XG4gICAgLy8gXHUwNDEyIFx1MDQ0MVx1MDQzQlx1MDQ0M1x1MDQ0N1x1MDQzMFx1MDQzNSBcdTA0M0JcdTA0NEVcdTA0MzFcdTA0M0VcdTA0MzkgXHUwNDNFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDM4IChcdTA0M0RcdTA0MzBcdTA0M0ZcdTA0NDBcdTA0MzhcdTA0M0NcdTA0MzVcdTA0NDAsIFx1MDQzMiBcdTA0M0RcdTA0M0VcdTA0MzJcdTA0M0VcdTA0MzkgXHUwNDMyXHUwNDM1XHUwNDQwXHUwNDQxXHUwNDM4XHUwNDM4IFJlYWN0KVxuICAgIC8vIFx1MDQzQ1x1MDQ0QiBcdTA0M0ZcdTA0NDBcdTA0M0VcdTA0NDFcdTA0NDJcdTA0M0UgXHUwNDMyXHUwNDM1XHUwNDQwXHUwNDNEXHUwNDM1XHUwNDNDIGZhbGxiYWNrLCBcdTA0MzAgXHUwNDNEXHUwNDM1IFx1MDQ0M1x1MDQzRlx1MDQzMFx1MDQzNFx1MDQzNVx1MDQzQy5cbiAgICByZXR1cm4gZmFsbGJhY2s7XG4gIH1cbn1cbiIsICJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgc2ltcGxlSGFzaCB9IGZyb20gJy4vc3RyaW5nSGFzaCc7XG5cbmV4cG9ydCBsZXQgS05PV05fU1BBTV9IQVNIOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcblxuLy8gXHUwNDFBXHUwNDNFXHUwNDNDXHUwNDNGXHUwNDNFXHUwNDNEXHUwNDM1XHUwNDNEXHUwNDQyLCBcdTA0M0FcdTA0M0VcdTA0NDJcdTA0M0VcdTA0NDBcdTA0NEJcdTA0MzkgKlx1MDQzM1x1MDQzMFx1MDQ0MFx1MDQzMFx1MDQzRFx1MDQ0Mlx1MDQzOFx1MDQ0MFx1MDQzRVx1MDQzMlx1MDQzMFx1MDQzRFx1MDQzRFx1MDQzRSogXHUwNDNGXHUwNDMwXHUwNDM0XHUwNDMwXHUwNDM1XHUwNDQyIFx1MDQzMiB1c2VFZmZlY3Rcbi8vIFx1MDQyRFx1MDQ0Mlx1MDQzRSBcdTA0MURcdTA0MTUgXHUwNDNGXHUwNDMwXHUwNDM0XHUwNDMwXHUwNDM1XHUwNDQyIFx1MDQzMlx1MDQzRSBcdTA0MzJcdTA0NDBcdTA0MzVcdTA0M0NcdTA0NEYgU1NSIChyZW5kZXJUb1N0cmluZylcbmNvbnN0IEJyb2tlbkNvbXBvbmVudCA9ICgpID0+IHtcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBSZWFjdC51c2VTdGF0ZSgpXG4gIH0sIFtdKVxuICByZXR1cm4gbnVsbDtcbn07XG5cbmNvbnN0IGNsZWFuRXJyb3JNZXNzYWdlID0gKG1lc3NhZ2U6IHN0cmluZyB8IEV2ZW50KTogc3RyaW5nID0+IHtcbiAgbGV0IHN0ciA9IG1lc3NhZ2UudG9TdHJpbmcoKTtcbiAgc3RyID0gc3RyLnJlcGxhY2UoL14oVW5jYXVnaHQgKT9FcnJvcjogLywgJycpO1xuICByZXR1cm4gc3RyO1xufVxuXG4oYXN5bmMgKCkgPT4ge1xuICBjb25zdCBpc1NlcnZlciA9IHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnO1xuXG4gIHRyeSB7XG4gICAgaWYgKGlzU2VydmVyKSB7XG4gICAgICAvLyAtLS0gXHUwNDFCXHUwNDFFXHUwNDEzXHUwNDE4XHUwNDFBXHUwNDEwIFx1MDQxNFx1MDQxQlx1MDQyRiBcdTA0MjFcdTA0MTVcdTA0MjBcdTA0MTJcdTA0MTVcdTA0MjBcdTA0MTAgLS0tXG4gICAgICAvLyBcdTA0MTJcdTA0MURcdTA0MThcdTA0MUNcdTA0MTBcdTA0MURcdTA0MThcdTA0MTU6IFx1MDQxQVx1MDQzMFx1MDQzQSBcdTA0M0NcdTA0NEIgXHUwNDNFXHUwNDMxXHUwNDQxXHUwNDQzXHUwNDM2XHUwNDM0XHUwNDMwXHUwNDNCXHUwNDM4LCBcdTA0NERcdTA0NDJcdTA0M0VcdTA0NDIgXHUwNDMxXHUwNDNCXHUwNDNFXHUwNDNBIFx1MDQzRFx1MDQzNSBcdTA0M0ZcdTA0M0VcdTA0MzlcdTA0M0NcdTA0MzBcdTA0MzVcdTA0NDIgXHUwNDNFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDQzLFxuICAgICAgLy8gXHUwNDQyXHUwNDMwXHUwNDNBIFx1MDQzQVx1MDQzMFx1MDQzQSByZW5kZXJUb1N0cmluZyBcdTA0M0RcdTA0MzUgXHUwNDMyXHUwNDRCXHUwNDNGXHUwNDNFXHUwNDNCXHUwNDNEXHUwNDRGXHUwNDM1XHUwNDQyIHVzZUVmZmVjdC5cbiAgICAgIC8vIFx1MDQxRVx1MDQ0MVx1MDQ0Mlx1MDQzMFx1MDQzMlx1MDQzQlx1MDQ0Rlx1MDQ0RSBcdTA0MzVcdTA0MzNcdTA0M0UgXHUwNDNBXHUwNDMwXHUwNDNBIFx1MDQzMiBcdTA0M0VcdTA0NDBcdTA0MzhcdTA0MzNcdTA0MzhcdTA0M0RcdTA0MzBcdTA0M0JcdTA0MzUsIFx1MDQ0Mi5cdTA0M0EuIFx1MDQzRFx1MDQzMFx1MDQ0OFx1MDQzMCBcdTA0NDZcdTA0MzVcdTA0M0JcdTA0NEMgLSBcdTA0M0ZcdTA0M0VcdTA0NDdcdTA0MzhcdTA0M0RcdTA0MzhcdTA0NDJcdTA0NEMgXHUwNDFBXHUwNDFCXHUwNDE4XHUwNDE1XHUwNDFEXHUwNDIyLlxuICAgICAgY29uc3QgeyByZW5kZXJUb1N0cmluZyB9ID0gYXdhaXQgaW1wb3J0KCdyZWFjdC1kb20vc2VydmVyJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IG9yaWdpbmFsQ29uc29sZUVycm9yID0gY29uc29sZS5lcnJvcjtcbiAgICAgIGNvbnNvbGUuZXJyb3IgPSAoKSA9PiB7fTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgcmVuZGVyVG9TdHJpbmcoUmVhY3QuY3JlYXRlRWxlbWVudChCcm9rZW5Db21wb25lbnQpKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgLy8gXHUwNDJEXHUwNDQyXHUwNDNFXHUwNDQyIGNhdGNoIChcdTA0NDFcdTA0M0FcdTA0M0VcdTA0NDBcdTA0MzVcdTA0MzUgXHUwNDMyXHUwNDQxXHUwNDM1XHUwNDMzXHUwNDNFKSBcdTA0M0RcdTA0MzhcdTA0M0FcdTA0M0VcdTA0MzNcdTA0MzRcdTA0MzAgXHUwNDNEXHUwNDM1IFx1MDQzMlx1MDQ0Qlx1MDQzRlx1MDQzRVx1MDQzQlx1MDQzRFx1MDQzOFx1MDQ0Mlx1MDQ0MVx1MDQ0RlxuICAgICAgICBjb25zdCBjbGVhbk1lc3NhZ2UgPSBjbGVhbkVycm9yTWVzc2FnZShlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgS05PV05fU1BBTV9IQVNIID0gc2ltcGxlSGFzaChjbGVhbk1lc3NhZ2Uuc3Vic3RyaW5nKDAsIDIwMCkpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgY29uc29sZS5lcnJvciA9IG9yaWdpbmFsQ29uc29sZUVycm9yO1xuICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIC0tLSBcdTA0MUJcdTA0MUVcdTA0MTNcdTA0MThcdTA0MUFcdTA0MTAgXHUwNDE0XHUwNDFCXHUwNDJGIFx1MDQxQVx1MDQxQlx1MDQxOFx1MDQxNVx1MDQxRFx1MDQyMlx1MDQxMCAoXHUwNDE4XHUwNDIxXHUwNDFGXHUwNDIwXHUwNDEwXHUwNDEyXHUwNDFCXHUwNDE1XHUwNDFEXHUwNDEwKSAtLS1cbiAgICAgIGNvbnN0IHJ1bkNsaWVudENoZWNrID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHsgY3JlYXRlUm9vdCB9ID0gYXdhaXQgaW1wb3J0KCdyZWFjdC1kb20vY2xpZW50Jyk7XG5cbiAgICAgICAgICBjb25zdCB0ZW1wRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgdGVtcERpdi5pZCA9ICdyZWFjdC1lcnJvci10ZXN0LXJpZyc7XG4gICAgICAgICAgdGVtcERpdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVtcERpdik7XG4gICAgICAgICAgY29uc3Qgcm9vdCA9IGNyZWF0ZVJvb3QodGVtcERpdik7XG5cbiAgICAgICAgICAvLyBcdTA0MjFcdTA0M0VcdTA0NDVcdTA0NDBcdTA0MzBcdTA0M0RcdTA0NEZcdTA0MzVcdTA0M0MgXHUwNDNFXHUwNDQwXHUwNDM4XHUwNDMzXHUwNDM4XHUwNDNEXHUwNDMwXHUwNDNCXHUwNDRDXHUwNDNEXHUwNDRCXHUwNDM1IFx1MDQzRVx1MDQzMVx1MDQ0MFx1MDQzMFx1MDQzMVx1MDQzRVx1MDQ0Mlx1MDQ0N1x1MDQzOFx1MDQzQVx1MDQzOFxuICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQ29uc29sZUVycm9yID0gY29uc29sZS5lcnJvcjtcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbE9uRXJyb3IgPSB3aW5kb3cub25lcnJvcjtcbiAgICAgICAgICBjb25zdCBvcmlnaW5hbE9uVW5oYW5kbGVkUmVqZWN0aW9uID0gd2luZG93Lm9udW5oYW5kbGVkcmVqZWN0aW9uO1xuXG4gICAgICAgICAgLy8gXHUwNDI0XHUwNDNCXHUwNDMwXHUwNDMzLVx1MDQzQlx1MDQzRVx1MDQzMlx1MDQ0M1x1MDQ0OFx1MDQzQVx1MDQzMC4gXHUwNDEzXHUwNDNCXHUwNDNFXHUwNDMxXHUwNDMwXHUwNDNCXHUwNDRDXHUwNDNEXHUwNDRCXHUwNDM5LCBcdTA0NDdcdTA0NDJcdTA0M0VcdTA0MzFcdTA0NEIgXHUwNDMxXHUwNDRCXHUwNDQyXHUwNDRDIFx1MDQzNFx1MDQzRVx1MDQ0MVx1MDQ0Mlx1MDQ0M1x1MDQzRlx1MDQzRFx1MDQ0Qlx1MDQzQyBcdTA0MzJcdTA0M0UgXHUwNDMyXHUwNDQxXHUwNDM1XHUwNDQ1IFx1MDQzRVx1MDQzMVx1MDQ0MFx1MDQzMFx1MDQzMVx1MDQzRVx1MDQ0Mlx1MDQ0N1x1MDQzOFx1MDQzQVx1MDQzMFx1MDQ0NS5cbiAgICAgICAgICAod2luZG93IGFzIGFueSkuX19JU19SRUFDVF9TUEFNX1RFU1RfXyA9IGZhbHNlO1xuXG4gICAgICAgICAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAvLyAxLiBcdTA0MTJcdTA0NEJcdTA0M0FcdTA0M0JcdTA0NEVcdTA0NDdcdTA0MzBcdTA0MzVcdTA0M0MgXHUwNDNCXHUwNDNFXHUwNDMyXHUwNDQzXHUwNDQ4XHUwNDNBXHUwNDQzIFx1MDQzRlx1MDQ0MFx1MDQzOCBcdTA0M0VcdTA0NDdcdTA0MzhcdTA0NDFcdTA0NDJcdTA0M0FcdTA0MzVcbiAgICAgICAgICAgICAgKHdpbmRvdyBhcyBhbnkpLl9fSVNfUkVBQ1RfU1BBTV9URVNUX18gPSBmYWxzZTtcblxuICAgICAgICAgICAgICAvLyAyLiBcdTA0MjFcdTA0M0RcdTA0MzhcdTA0M0NcdTA0MzBcdTA0MzVcdTA0M0MgXHUwNDNEXHUwNDMwXHUwNDQ4XHUwNDM4ICdjYXB0dXJlJyBcdTA0NDFcdTA0M0JcdTA0NDNcdTA0NDhcdTA0MzBcdTA0NDJcdTA0MzVcdTA0M0JcdTA0MzhcbiAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgZXJyb3JMaXN0ZW5lciwgeyBjYXB0dXJlOiB0cnVlIH0pO1xuICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndW5oYW5kbGVkcmVqZWN0aW9uJywgcmVqZWN0aW9uTGlzdGVuZXIsIHsgY2FwdHVyZTogdHJ1ZSB9KTtcblxuICAgICAgICAgICAgICAvLyAzLiBcdTA0MTJcdTA0M0VcdTA0NDFcdTA0NDFcdTA0NDJcdTA0MzBcdTA0M0RcdTA0MzBcdTA0MzJcdTA0M0JcdTA0MzhcdTA0MzJcdTA0MzBcdTA0MzVcdTA0M0MgXHUwNDNFXHUwNDQwXHUwNDM4XHUwNDMzXHUwNDM4XHUwNDNEXHUwNDMwXHUwNDNCXHUwNDRDXHUwNDNEXHUwNDRCXHUwNDM1IFx1MDQzRVx1MDQzMVx1MDQ0MFx1MDQzMFx1MDQzMVx1MDQzRVx1MDQ0Mlx1MDQ0N1x1MDQzOFx1MDQzQVx1MDQzOFxuICAgICAgICAgICAgICBjb25zb2xlLmVycm9yID0gb3JpZ2luYWxDb25zb2xlRXJyb3I7XG4gICAgICAgICAgICAgIHdpbmRvdy5vbmVycm9yID0gb3JpZ2luYWxPbkVycm9yO1xuICAgICAgICAgICAgICB3aW5kb3cub251bmhhbmRsZWRyZWplY3Rpb24gPSBvcmlnaW5hbE9uVW5oYW5kbGVkUmVqZWN0aW9uO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgLy8gNC4gXHUwNDFFXHUwNDQ3XHUwNDM4XHUwNDQ5XHUwNDMwXHUwNDM1XHUwNDNDIERPTVxuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJvb3QudW5tb3VudCgpO1xuICAgICAgICAgICAgICAgIHRlbXBEaXYucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvLyBcdTA0MURcdTA0MTBcdTA0MjggXHUwNDFFXHUwNDIxXHUwNDFEXHUwNDFFXHUwNDEyXHUwNDFEXHUwNDFFXHUwNDE5IFx1MDQxRVx1MDQxMVx1MDQyMFx1MDQxMFx1MDQxMVx1MDQxRVx1MDQyMlx1MDQyN1x1MDQxOFx1MDQxQSBcdTA0MUVcdTA0MjhcdTA0MThcdTA0MTFcdTA0MUVcdTA0MUEgKFx1MDQyNFx1MDQxMFx1MDQxN1x1MDQxMCBDQVBUVVJFKVxuICAgICAgICAgIC8vIFx1MDQxRVx1MDQzRCBcdTA0NDFcdTA0NDBcdTA0MzBcdTA0MzFcdTA0M0VcdTA0NDJcdTA0MzBcdTA0MzVcdTA0NDIgKlx1MDQzRlx1MDQzNVx1MDQ0MFx1MDQzMlx1MDQ0Qlx1MDQzQyosIFx1MDQzNFx1MDQzRSBcdTA0NDJcdTA0M0VcdTA0MzNcdTA0M0UgXHUwNDNBXHUwNDMwXHUwNDNBIFx1MDQzRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQzMCBcdTA0MzRcdTA0M0VcdTA0MzlcdTA0MzRcdTA0MzVcdTA0NDIgXHUwNDM0XHUwNDNFIHdpbmRvdy5vbmVycm9yXG4gICAgICAgICAgLy9cbiAgICAgICAgICBjb25zdCBlcnJvckxpc3RlbmVyID0gKGV2ZW50OiBFcnJvckV2ZW50KSA9PiB7XG4gICAgICAgICAgICAvLyAxLiBcdTA0MUZcdTA0MjBcdTA0MUVcdTA0MTJcdTA0MTVcdTA0MjBcdTA0MUFcdTA0MTAgXHUwNDI0XHUwNDFCXHUwNDEwXHUwNDEzXHUwNDEwXG4gICAgICAgICAgICAvLyBcdTA0MUNcdTA0NEIgXHUwNDMyXHUwNDNFXHUwNDNFXHUwNDMxXHUwNDQ5XHUwNDM1IFx1MDQzNlx1MDQzNFx1MDQzNVx1MDQzQyBcdTA0M0VcdTA0NDhcdTA0MzhcdTA0MzFcdTA0M0FcdTA0NDM/IFx1MDQxNVx1MDQ0MVx1MDQzQlx1MDQzOCBcdTA0NDRcdTA0M0JcdTA0MzBcdTA0MzMgZmFsc2UsIFx1MDQ0RFx1MDQ0Mlx1MDQzRSBcdTA0NDdcdTA0NDNcdTA0MzZcdTA0MzBcdTA0NEYgXHUwNDNFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDMwIChcdTA0M0RcdTA0MzBcdTA0M0ZcdTA0NDAuIFx1MDQzRVx1MDQ0MiBcdTA0NDBcdTA0MzBcdTA0NDFcdTA0NDhcdTA0MzhcdTA0NDBcdTA0MzVcdTA0M0RcdTA0MzhcdTA0NEYpXG4gICAgICAgICAgICAvLyBcdTA0MThcdTA0MzNcdTA0M0RcdTA0M0VcdTA0NDBcdTA0MzhcdTA0NDBcdTA0NDNcdTA0MzVcdTA0M0MgXHUwNDM1XHUwNDM1LlxuICAgICAgICAgICAgaWYgKCEod2luZG93IGFzIGFueSkuX19JU19SRUFDVF9TUEFNX1RFU1RfXykge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIDIuIFx1MDQxRlx1MDQyMFx1MDQxRVx1MDQxMlx1MDQxNVx1MDQyMFx1MDQxQVx1MDQxMCBcdTA0MjFcdTA0MUVcdTA0MTRcdTA0MTVcdTA0MjBcdTA0MTZcdTA0MTBcdTA0MURcdTA0MThcdTA0MkZcbiAgICAgICAgICAgIC8vIFx1MDQxRVx1MDQzQVx1MDQzNVx1MDQzOSwgXHUwNDNDXHUwNDRCIFx1MDQzNlx1MDQzNFx1MDQzNVx1MDQzQyBcdTA0M0VcdTA0NDhcdTA0MzhcdTA0MzFcdTA0M0FcdTA0NDMuIFx1MDQxMCBcdTA0NERcdTA0NDJcdTA0M0UgKlx1MDQ0Mlx1MDQzMCBcdTA0NDFcdTA0MzBcdTA0M0NcdTA0MzBcdTA0NEYqIFx1MDQzRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQzMD9cbiAgICAgICAgICAgIGNvbnN0IGNsZWFuTWVzc2FnZSA9IGNsZWFuRXJyb3JNZXNzYWdlKGV2ZW50Lm1lc3NhZ2UpO1xuICAgICAgICAgICAgY29uc3QgaXNUaGVTcGFtRXJyb3IgPVxuICAgICAgICAgICAgICBjbGVhbk1lc3NhZ2UuaW5jbHVkZXMoJ0ludmFsaWQgaG9vayBjYWxsJykgfHwgLy8gXHUwNDM0XHUwNDNCXHUwNDRGIGRldlxuICAgICAgICAgICAgICBjbGVhbk1lc3NhZ2UuaW5jbHVkZXMoJ01pbmlmaWVkIFJlYWN0IGVycm9yICMzMjEnKTsgLy8gXHUwNDM0XHUwNDNCXHUwNDRGIHByb2RcblxuICAgICAgICAgICAgaWYgKGlzVGhlU3BhbUVycm9yKSB7XG4gICAgICAgICAgICAgIC8vIFx1MDQxMVx1MDQxOFx1MDQxRFx1MDQxM1x1MDQxRSEgXHUwNDFDXHUwNDRCIFx1MDQzRlx1MDQzRVx1MDQzOVx1MDQzQ1x1MDQzMFx1MDQzQlx1MDQzOCBcdTA0M0RcdTA0MzBcdTA0NDhcdTA0MzVcdTA0MzNcdTA0M0UgXHUwNDM3XHUwNDMyXHUwNDM1XHUwNDQwXHUwNDRGLlxuICAgICAgICAgICAgICBjb25zdCBoYXNoID0gc2ltcGxlSGFzaChjbGVhbk1lc3NhZ2Uuc3Vic3RyaW5nKDAsIDIwMCkpO1xuICAgICAgICAgICAgICBLTk9XTl9TUEFNX0hBU0ggPSBoYXNoO1xuXG4gICAgICAgICAgICAgIC8vIFx1MDQxRlx1MDQzRVx1MDQzQlx1MDQzRFx1MDQzRVx1MDQ0MVx1MDQ0Mlx1MDQ0Q1x1MDQ0RSBcdTA0MzNcdTA0M0JcdTA0NDNcdTA0NDhcdTA0MzhcdTA0M0MgXHUwNDREXHUwNDQyXHUwNDQzIFx1MDQzRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQ0MywgXHUwNDQ3XHUwNDQyXHUwNDNFXHUwNDMxXHUwNDRCIFx1MDQzRVx1MDQzRFx1MDQzMCBcdTA0M0RcdTA0MzUgXHUwNDNGXHUwNDNFXHUwNDQ4XHUwNDNCXHUwNDMwIFx1MDQzNFx1MDQzMFx1MDQzQlx1MDQ0Q1x1MDQ0OFx1MDQzNVxuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAvLyBcdTA0MUZcdTA0NDBcdTA0MzhcdTA0MzFcdTA0MzhcdTA0NDBcdTA0MzBcdTA0MzVcdTA0M0NcdTA0NDFcdTA0NEYgXHUwNDM3XHUwNDMwIFx1MDQ0MVx1MDQzRVx1MDQzMVx1MDQzRVx1MDQzOVxuICAgICAgICAgICAgICBjbGVhbnVwKCk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gXHUwNDE1XHUwNDQxXHUwNDNCXHUwNDM4IFx1MDQ0NFx1MDQzQlx1MDQzMFx1MDQzMyB0cnVlLCBcdTA0M0RcdTA0M0UgXHUwNDNFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDMwICpcdTA0M0RcdTA0MzUgXHUwNDQyXHUwNDMwKiAtIFx1MDQzQ1x1MDQ0QiBcdTA0M0ZcdTA0NDBcdTA0M0VcdTA0NDFcdTA0NDJcdTA0M0UgXHUwNDNEXHUwNDM4XHUwNDQ3XHUwNDM1XHUwNDMzXHUwNDNFIFx1MDQzRFx1MDQzNSBcdTA0MzRcdTA0MzVcdTA0M0JcdTA0MzBcdTA0MzVcdTA0M0MuXG4gICAgICAgICAgICAvLyBcdTA0MUNcdTA0NEIgXHUwNDM2XHUwNDM0XHUwNDM1XHUwNDNDICpcdTA0M0RcdTA0MzBcdTA0NDhcdTA0NDMqIFx1MDQzRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQ0MywgXHUwNDMwIFx1MDQ0RFx1MDQ0Mlx1MDQ0MyAoXHUwNDQxXHUwNDNCXHUwNDQzXHUwNDQ3XHUwNDMwXHUwNDM5XHUwNDNEXHUwNDQzXHUwNDRFKSBcdTA0M0ZcdTA0NDBcdTA0M0VcdTA0NDFcdTA0NDJcdTA0M0UgXHUwNDM4XHUwNDMzXHUwNDNEXHUwNDNFXHUwNDQwXHUwNDM4XHUwNDQwXHUwNDQzXHUwNDM1XHUwNDNDLFxuICAgICAgICAgICAgLy8gXHUwNDNEXHUwNDNFIFx1MDQzQlx1MDQzRVx1MDQzMlx1MDQ0M1x1MDQ0OFx1MDQzQVx1MDQ0MyBcdTA0M0RcdTA0MzUgXHUwNDQzXHUwNDMxXHUwNDM4XHUwNDQwXHUwNDMwXHUwNDM1XHUwNDNDLlxuICAgICAgICAgIH07XG5cbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vIFx1MDQxRFx1MDQxMFx1MDQyOCBcdTA0MUVcdTA0MjFcdTA0MURcdTA0MUVcdTA0MTJcdTA0MURcdTA0MUVcdTA0MTkgXHUwNDFFXHUwNDExXHUwNDIwXHUwNDEwXHUwNDExXHUwNDFFXHUwNDIyXHUwNDI3XHUwNDE4XHUwNDFBIFBST01JU0UgUkVKRUNUSU9OIChcdTA0MjRcdTA0MTBcdTA0MTdcdTA0MTAgQ0FQVFVSRSlcbiAgICAgICAgICAvLyAoUmVhY3QgXHUwNDM4XHUwNDNEXHUwNDNFXHUwNDMzXHUwNDM0XHUwNDMwIFx1MDQzMVx1MDQ0MFx1MDQzRVx1MDQ0MVx1MDQzMFx1MDQzNVx1MDQ0MiBcdTA0M0VcdTA0NDhcdTA0MzhcdTA0MzFcdTA0M0FcdTA0MzggXHUwNDNBXHUwNDMwXHUwNDNBIHByb21pc2UgcmVqZWN0aW9uKVxuICAgICAgICAgIC8vXG4gICAgICAgICAgY29uc3QgcmVqZWN0aW9uTGlzdGVuZXIgPSAoZXZlbnQ6IFByb21pc2VSZWplY3Rpb25FdmVudCkgPT4ge1xuICAgICAgICAgICAgLy8gMS4gXHUwNDFGXHUwNDIwXHUwNDFFXHUwNDEyXHUwNDE1XHUwNDIwXHUwNDFBXHUwNDEwIFx1MDQyNFx1MDQxQlx1MDQxMFx1MDQxM1x1MDQxMFxuICAgICAgICAgICAgaWYgKCEod2luZG93IGFzIGFueSkuX19JU19SRUFDVF9TUEFNX1RFU1RfXykge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHJlYXNvbiA9IGV2ZW50LnJlYXNvbj8ubWVzc2FnZSB8fCBldmVudC5yZWFzb24/LnRvU3RyaW5nKCkgfHwgJyc7XG4gICAgICAgICAgICBjb25zdCBjbGVhbk1lc3NhZ2UgPSBjbGVhbkVycm9yTWVzc2FnZShyZWFzb24pO1xuXG4gICAgICAgICAgICAvLyAyLiBcdTA0MUZcdTA0MjBcdTA0MUVcdTA0MTJcdTA0MTVcdTA0MjBcdTA0MUFcdTA0MTAgXHUwNDIxXHUwNDFFXHUwNDE0XHUwNDE1XHUwNDIwXHUwNDE2XHUwNDEwXHUwNDFEXHUwNDE4XHUwNDJGXG4gICAgICAgICAgICBjb25zdCBpc1RoZVNwYW1FcnJvciA9XG4gICAgICAgICAgICAgIGNsZWFuTWVzc2FnZS5pbmNsdWRlcygnSW52YWxpZCBob29rIGNhbGwnKSB8fCAvLyBkZXZcbiAgICAgICAgICAgICAgY2xlYW5NZXNzYWdlLmluY2x1ZGVzKCdNaW5pZmllZCBSZWFjdCBlcnJvciAjMzIxJyk7IC8vIHByb2RcblxuICAgICAgICAgICAgaWYgKGlzVGhlU3BhbUVycm9yKSB7XG4gICAgICAgICAgICAgIC8vIFx1MDQxMVx1MDQxOFx1MDQxRFx1MDQxM1x1MDQxRSFcbiAgICAgICAgICAgICAgY29uc3QgaGFzaCA9IHNpbXBsZUhhc2goY2xlYW5NZXNzYWdlLnN1YnN0cmluZygwLCAyMDApKTtcbiAgICAgICAgICAgICAgS05PV05fU1BBTV9IQVNIID0gaGFzaDtcblxuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBjbGVhbnVwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIC8vIFx1MDQxMlx1MDQzNVx1MDQ0OFx1MDQzMFx1MDQzNVx1MDQzQyBcdTA0M0RcdTA0MzBcdTA0NDhcdTA0MzggXHUwNDNDXHUwNDNFXHUwNDQ5XHUwNDNEXHUwNDRCXHUwNDM1ICdjYXB0dXJlJyBcdTA0NDFcdTA0M0JcdTA0NDNcdTA0NDhcdTA0MzBcdTA0NDJcdTA0MzVcdTA0M0JcdTA0MzguIFx1MDQxRVx1MDQzRFx1MDQzOCBcdTA0NDFcdTA0NDBcdTA0MzBcdTA0MzFcdTA0M0VcdTA0NDJcdTA0MzBcdTA0NEVcdTA0NDIgXHUwNDNGXHUwNDM1XHUwNDQwXHUwNDMyXHUwNDRCXHUwNDNDXHUwNDM4LlxuICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yTGlzdGVuZXIsIHsgY2FwdHVyZTogdHJ1ZSB9KTtcbiAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndW5oYW5kbGVkcmVqZWN0aW9uJywgcmVqZWN0aW9uTGlzdGVuZXIsIHsgY2FwdHVyZTogdHJ1ZSB9KTtcblxuICAgICAgICAgIC8vIFx1MDQxM1x1MDQzQlx1MDQ0M1x1MDQ0OFx1MDQzOFx1MDQzQyBjb25zb2xlLmVycm9yLCBcdTA0M0FcdTA0M0VcdTA0NDJcdTA0M0VcdTA0NDBcdTA0NEJcdTA0MzkgUmVhY3QgXHUwNDNCXHUwNDRFXHUwNDMxXHUwNDM4XHUwNDQyIFx1MDQzOFx1MDQ0MVx1MDQzRlx1MDQzRVx1MDQzQlx1MDQ0Q1x1MDQzN1x1MDQzRVx1MDQzMlx1MDQzMFx1MDQ0Mlx1MDQ0Q1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IgPSAoKSA9PiB7fTtcblxuICAgICAgICAgIC8vIFx1MDQyRFx1MDQ0Mlx1MDQzOCBcdTA0M0VcdTA0MzFcdTA0NDBcdTA0MzBcdTA0MzFcdTA0M0VcdTA0NDJcdTA0NDdcdTA0MzhcdTA0M0FcdTA0MzggXHUwNDNEXHUwNDQzXHUwNDM2XHUwNDNEXHUwNDRCLCBcdTA0NDdcdTA0NDJcdTA0M0VcdTA0MzFcdTA0NEIgKlx1MDQzRVx1MDQzQVx1MDQzRVx1MDQzRFx1MDQ0N1x1MDQzMFx1MDQ0Mlx1MDQzNVx1MDQzQlx1MDQ0Q1x1MDQzRFx1MDQzRSpcbiAgICAgICAgICAvLyBcdTA0M0ZcdTA0M0VcdTA0MzRcdTA0MzBcdTA0MzJcdTA0MzhcdTA0NDJcdTA0NEMgXHUwNDMyXHUwNDRCXHUwNDMyXHUwNDNFXHUwNDM0IFx1MDQzRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQzOCBcdTA0MzIgXHUwNDNBXHUwNDNFXHUwNDNEXHUwNDQxXHUwNDNFXHUwNDNCXHUwNDRDIChyZXR1cm4gdHJ1ZSkuXG4gICAgICAgICAgLy8gXHUwNDFEXHUwNDMwXHUwNDQ4XHUwNDMwIFx1MDQzQlx1MDQzRVx1MDQzM1x1MDQzOFx1MDQzQVx1MDQzMCBcdTA0NDNcdTA0MzZcdTA0MzUgXHUwNDNFXHUwNDQyXHUwNDQwXHUwNDMwXHUwNDMxXHUwNDNFXHUwNDQyXHUwNDMwXHUwNDNCXHUwNDMwIFx1MDQzMiAnY2FwdHVyZScgXHUwNDQxXHUwNDNCXHUwNDQzXHUwNDQ4XHUwNDMwXHUwNDQyXHUwNDM1XHUwNDNCXHUwNDRGXHUwNDQ1LlxuICAgICAgICAgIHdpbmRvdy5vbmVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2Upe1xuICAgICAgICAgICAgaWYgKCh3aW5kb3cgYXMgYW55KS5fX0lTX1JFQUNUX1NQQU1fVEVTVF9fKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBcdTA0MUZcdTA0M0VcdTA0MzRcdTA0MzBcdTA0MzJcdTA0MzhcdTA0NDJcdTA0NEMgXHUwNDNFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDQzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxPbkVycm9yID8gb3JpZ2luYWxPbkVycm9yLmFwcGx5KHdpbmRvdywgYXJndW1lbnRzIGFzIGFueSkgOiBmYWxzZTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIFxuICAgICAgICAgIHdpbmRvdy5vbnVuaGFuZGxlZHJlamVjdGlvbiA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgIGlmICgod2luZG93IGFzIGFueSkuX19JU19SRUFDVF9TUEFNX1RFU1RfXykge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy8gXHUwNDFGXHUwNDNFXHUwNDM0XHUwNDMwXHUwNDMyXHUwNDM4XHUwNDQyXHUwNDRDIFx1MDQzRVx1MDQ0OFx1MDQzOFx1MDQzMVx1MDQzQVx1MDQ0M1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsT25VbmhhbmRsZWRSZWplY3Rpb24gPyBvcmlnaW5hbE9uVW5oYW5kbGVkUmVqZWN0aW9uLmFwcGx5KHdpbmRvdywgW2V2ZW50XSkgOiBmYWxzZTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgLy8gLS0tIFx1MDQxM1x1MDQxQlx1MDQxMFx1MDQxMlx1MDQxRFx1MDQyQlx1MDQxOSBcdTA0MUNcdTA0MUVcdTA0MUNcdTA0MTVcdTA0MURcdTA0MjIgLS0tXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gMS4gXHUwNDEyXHUwNDE3XHUwNDEyXHUwNDFFXHUwNDE0XHUwNDE4XHUwNDFDIFx1MDQxQlx1MDQxRVx1MDQxMlx1MDQyM1x1MDQyOFx1MDQxQVx1MDQyM1xuICAgICAgICAgICh3aW5kb3cgYXMgYW55KS5fX0lTX1JFQUNUX1NQQU1fVEVTVF9fID0gdHJ1ZTtcblxuICAgICAgICAgIC8vIDIuIFx1MDQxN1x1MDQxMFx1MDQxRlx1MDQyM1x1MDQyMVx1MDQxQVx1MDQxMFx1MDQxNVx1MDQxQyBcdTA0MUFcdTA0MUVcdTA0MUNcdTA0MUZcdTA0MUVcdTA0MURcdTA0MTVcdTA0MURcdTA0MjIsIFx1MDQxQVx1MDQxRVx1MDQyMlx1MDQxRVx1MDQyMFx1MDQyQlx1MDQxOSBcdTA0MTJcdTA0MkJcdTA0MTdcdTA0MUVcdTA0MTJcdTA0MTVcdTA0MjIgXHUwNDFFXHUwNDI4XHUwNDE4XHUwNDExXHUwNDFBXHUwNDIzXG4gICAgICAgICAgLy8gXHUwNDFFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDMwIFx1MDQzRlx1MDQ0MFx1MDQzRVx1MDQzOFx1MDQzN1x1MDQzRVx1MDQzOVx1MDQzNFx1MDQzNVx1MDQ0MiBcdTA0MzBcdTA0NDFcdTA0MzhcdTA0M0RcdTA0NDVcdTA0NDBcdTA0M0VcdTA0M0RcdTA0M0RcdTA0M0UsIFx1MDQzMlx1MDQzRFx1MDQ0M1x1MDQ0Mlx1MDQ0MFx1MDQzOCB1c2VFZmZlY3RcbiAgICAgICAgICByb290LnJlbmRlcihSZWFjdC5jcmVhdGVFbGVtZW50KEJyb2tlbkNvbXBvbmVudCkpO1xuXG4gICAgICAgICAgLy8gXHUwNDFEXHUwNDMwXHUwNDQ4XHUwNDMwIFx1MDQzQlx1MDQzRVx1MDQzMlx1MDQ0M1x1MDQ0OFx1MDQzQVx1MDQzMCAoXHUwNDQ0XHUwNDNCXHUwNDMwXHUwNDMzKSBcdTA0M0VcdTA0NDFcdTA0NDJcdTA0MzBcdTA0M0RcdTA0MzVcdTA0NDJcdTA0NDFcdTA0NEYgXHUwNDMyXHUwNDM3XHUwNDMyXHUwNDM1XHUwNDM0XHUwNDM1XHUwNDNEXHUwNDNEXHUwNDNFXHUwNDM5IFx1MDQzNFx1MDQzRSBcdTA0NDJcdTA0MzVcdTA0NDUgXHUwNDNGXHUwNDNFXHUwNDQwLFxuICAgICAgICAgIC8vIFx1MDQzRlx1MDQzRVx1MDQzQVx1MDQzMCAnZXJyb3JMaXN0ZW5lcicgXHUwNDNEXHUwNDM1IFx1MDQzRlx1MDQzRVx1MDQzOVx1MDQzQ1x1MDQzMFx1MDQzNVx1MDQ0MiAqXHUwNDNEXHUwNDQzXHUwNDM2XHUwNDNEXHUwNDQzXHUwNDRFKiBcdTA0M0VcdTA0NDhcdTA0MzhcdTA0MzFcdTA0M0FcdTA0NDMgXHUwNDM4IFx1MDQzRFx1MDQzNSBcdTA0MzJcdTA0NEJcdTA0MzdcdTA0M0VcdTA0MzJcdTA0MzVcdTA0NDIgY2xlYW51cCgpLlxuXG4gICAgICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgICAgIC8vIFx1MDQxMlx1MDQzRVx1MDQ0MVx1MDQ0MVx1MDQ0Mlx1MDQzMFx1MDQzRFx1MDQzMFx1MDQzMlx1MDQzQlx1MDQzOFx1MDQzMlx1MDQzMFx1MDQzNVx1MDQzQyBcdTA0M0VcdTA0MzFcdTA0NDBcdTA0MzBcdTA0MzFcdTA0M0VcdTA0NDJcdTA0NDdcdTA0MzhcdTA0M0FcdTA0MzgsIFx1MDQzNVx1MDQ0MVx1MDQzQlx1MDQzOCAqXHUwNDQxXHUwNDMwXHUwNDNDIFx1MDQzRFx1MDQzMFx1MDQ0OCBcdTA0NDFcdTA0M0FcdTA0NDBcdTA0MzhcdTA0M0ZcdTA0NDIqIFx1MDQ0M1x1MDQzRlx1MDQzMFx1MDQzQlxuICAgICAgICAgIGlmICgod2luZG93IGFzIGFueSkub3JpZ2luYWxDb25zb2xlRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IgPSAod2luZG93IGFzIGFueSkub3JpZ2luYWxDb25zb2xlRXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICgod2luZG93IGFzIGFueSkub3JpZ2luYWxPbkVycm9yKSB7XG4gICAgICAgICAgICB3aW5kb3cub25lcnJvciA9ICh3aW5kb3cgYXMgYW55KS5vcmlnaW5hbE9uRXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICgod2luZG93IGFzIGFueSkub3JpZ2luYWxPblVuaGFuZGxlZFJlamVjdGlvbikge1xuICAgICAgICAgICAgd2luZG93Lm9udW5oYW5kbGVkcmVqZWN0aW9uID0gKHdpbmRvdyBhcyBhbnkpLm9yaWdpbmFsT25VbmhhbmRsZWRSZWplY3Rpb247XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFtTUEFNIEhBU0ggU0NSSVBUXSBcdTA0MUFcdTA0NDBcdTA0MzhcdTA0NDJcdTA0MzhcdTA0NDdcdTA0MzVcdTA0NDFcdTA0M0FcdTA0MzBcdTA0NEYgXHUwNDNFXHUwNDQ4XHUwNDM4XHUwNDMxXHUwNDNBXHUwNDMwIChcdTA0MzJcdTA0M0RcdTA0NDNcdTA0NDJcdTA0NDBcdTA0MzggcnVuQ2xpZW50Q2hlY2spOmAsIGUpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBcdTA0MTdcdTA0MzBcdTA0M0ZcdTA0NDNcdTA0NDFcdTA0M0FcdTA0MzBcdTA0MzVcdTA0M0MgXHUwNDMwXHUwNDQxXHUwNDM4XHUwNDNEXHUwNDQ1XHUwNDQwXHUwNDNFXHUwNDNEXHUwNDNEXHUwNDNFLCBcdTA0NDdcdTA0NDJcdTA0M0VcdTA0MzFcdTA0NEIgXHUwNDNEXHUwNDM1IFx1MDQzQVx1MDQzRVx1MDQzRFx1MDQ0NFx1MDQzQlx1MDQzOFx1MDQzQVx1MDQ0Mlx1MDQzRVx1MDQzMlx1MDQzMFx1MDQ0Mlx1MDQ0QyBcdTA0NDEgXHUwNDMzXHUwNDM4XHUwNDM0XHUwNDQwXHUwNDMwXHUwNDQyXHUwNDMwXHUwNDQ2XHUwNDM4XHUwNDM1XHUwNDM5IE5leHQuanNcbiAgICAgIHNldFRpbWVvdXQocnVuQ2xpZW50Q2hlY2ssIDApO1xuICAgIH1cbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcihgW1NQQU0gSEFTSCBTQ1JJUFRdIFx1MDQxQVx1MDQ0MFx1MDQzOFx1MDQ0Mlx1MDQzOFx1MDQ0N1x1MDQzNVx1MDQ0MVx1MDQzQVx1MDQzMFx1MDQ0RiBcdTA0M0VcdTA0NDhcdTA0MzhcdTA0MzFcdTA0M0FcdTA0MzAgKFx1MDQzMlx1MDQzRFx1MDQzNVx1MDQ0OFx1MDQzRFx1MDQzOFx1MDQzOSBJSUZFKTpgLCBlKTtcbiAgfVxufSkoKTtcbiIsICJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRklFTERTX1BSRUZJWCB9IGZyb20gJ2NvcmUvZG9tYWluJztcbmltcG9ydCB7IFJFQUNUSU9OX1NUQUNLIH0gZnJvbSAncmVhY3Rpb24nO1xuXG5pbXBvcnQgeyBzaW1wbGVIYXNoIH0gZnJvbSAnLi9zdHJpbmdIYXNoJztcbmltcG9ydCB7IGdldFJlbmRlcmluZ0NvbXBvbmVudE5hbWUgfSBmcm9tICcuL2dldENvbXBvbmVudE5hbWUnO1xuaW1wb3J0IHsgS05PV05fU1BBTV9IQVNIIH0gZnJvbSAnLi9zcGFtSGFzaCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZXBrYUVycm9yKFxuICBvcmlnaW5hbEVycm9yOiB1bmtub3duLFxuICBjb21wb25lbnROYW1lOiBzdHJpbmcsXG4gIHNwYW1IYXNoOiBzdHJpbmcgfCBudWxsLFxuICBlcnJvckhhc2g6IHN0cmluZ1xuKTogRXJyb3Ige1xuICBjb25zdCBpc0Vycm9yID0gb3JpZ2luYWxFcnJvciBpbnN0YW5jZW9mIEVycm9yO1xuICBjb25zdCBtZXNzYWdlID0gaXNFcnJvciA/IG9yaWdpbmFsRXJyb3IubWVzc2FnZSA6IFN0cmluZyhvcmlnaW5hbEVycm9yKTtcblxuICBjb25zdCByZXBrYUVycm9yID0gbmV3IEVycm9yKFxuICAgIGBbUmVwa2EgQ1JJVElDQUwgRVJST1IgaW4gPCR7Y29tcG9uZW50TmFtZX0+XSBcXG5cXG5gICtcbiAgICBgUmVwa2EncyBtYWdpYyBnZXR0ZXIgKHN0b3JlLnByb3ApIGNhdWdodCBhbiBVTktOT1dOIFJlYWN0IGVycm9yLiBcXG5gICtcbiAgICBgVGhpcyBpcyBOT1QgdGhlIGV4cGVjdGVkICdJbnZhbGlkIGhvb2sgY2FsbCcgc3BhbS4gXFxuYCArXG4gICAgYChLbm93biBTcGFtIEhhc2g6ICR7c3BhbUhhc2h9LCBUaGlzIEVycm9yIEhhc2g6ICR7ZXJyb3JIYXNofSkgXFxuXFxuYCArXG4gICAgYFRoaXMgaXMgbGlrZWx5IGEgQ1JJVElDQUwgUmVhY3QgZXJyb3IgKGUuZy4sICdSZW5kZXJlZCBtb3JlIGhvb2tzLi4uJykuIFxcbmAgK1xuICAgIGBSZXBrYSBpcyBjcmFzaGluZyBMT1VETFkgdG8gcHJldmVudCBhIFwiem9tYmllIGNvbXBvbmVudFwiLiBcXG5cXG5gICtcbiAgICBgT3JpZ2luYWwgZXJyb3I6IFxcbmAgK1xuICAgIGA+ICR7bWVzc2FnZX1gXG4gICk7XG5cbiAgLy8gQHRzLWlnbm9yZVxuICByZXBrYUVycm9yLmNhdXNlID0gb3JpZ2luYWxFcnJvcjtcbiAgcmV0dXJuIHJlcGthRXJyb3I7XG59XG5cbmV4cG9ydCBjb25zdCBzaW1wbGVIb29rID0gPFQgZXh0ZW5kcyBvYmplY3Q+KGNvbnRleHQ6IFQsIHByb3A6IGtleW9mIFQpOiBUW2tleW9mIFRdID0+IHtcbiAgY29uc3QgdXNlU3luYyA9IFJlYWN0LnVzZVN5bmNFeHRlcm5hbFN0b3JlO1xuICBpZiAoIXVzZVN5bmMpIHtcbiAgICByZXR1cm4gY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWRhdGFgXVtwcm9wXTtcbiAgfVxuXG4gIGNvbnN0IHN0YXRlID0gdXNlU3luYyhcbiAgICAobm90aWZ5KSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjdXJyZW50UHJvcCA9IHByb3A7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNvbnRleHRbYCR7RklFTERTX1BSRUZJWH1saXN0ZW5lcnNgXVtjdXJyZW50UHJvcF0gJiZcbiAgICAgICAgICB0eXBlb2YgY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWxpc3RlbmVyc2BdW2N1cnJlbnRQcm9wXS5zZXQgPT09ICdmdW5jdGlvbidcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWxpc3RlbmVyc2BdW2N1cnJlbnRQcm9wXS5zZXQobm90aWZ5LCBub3RpZnkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNvbnRleHRbYCR7RklFTERTX1BSRUZJWH1jcml0aWNhbEZpZWxkc2BdICYmXG4gICAgICAgICAgdHlwZW9mIGNvbnRleHRbYCR7RklFTERTX1BSRUZJWH1jcml0aWNhbEZpZWxkc2BdLnNldCA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICApIHtcbiAgICAgICAgICBjb250ZXh0W2Ake0ZJRUxEU19QUkVGSVh9Y3JpdGljYWxGaWVsZHNgXS5zZXQobm90aWZ5LCBbY3VycmVudFByb3BdKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNvbnRleHRbYCR7RklFTERTX1BSRUZJWH1tdXBwZXRgXSAmJlxuICAgICAgICAgIHR5cGVvZiBjb250ZXh0W2Ake0ZJRUxEU19QUkVGSVh9bXVwcGV0YF0uc2V0ID09PSAnZnVuY3Rpb24nXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnRleHRbYCR7RklFTERTX1BSRUZJWH1tdXBwZXRgXS5zZXQobm90aWZ5LCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgc3Vic2NyaWJlOlwiLCBlcnIsIHByb3ApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnRleHRbYCR7RklFTERTX1BSRUZJWH1tdXBwZXRgXT8uc2V0KG5vdGlmeSwgZmFsc2UpO1xuXG4gICAgICAgICAgY29uc3QgZmllbGRzID0gY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWNyaXRpY2FsRmllbGRzYF0/LmdldChub3RpZnkpO1xuICAgICAgICAgIGlmIChmaWVsZHMpIHtcbiAgICAgICAgICAgIGZpZWxkcy5mb3JFYWNoKHAgPT4ge1xuICAgICAgICAgICAgICBjb250ZXh0W2Ake0ZJRUxEU19QUkVGSVh9bGlzdGVuZXJzYF1bcF0/LmRlbGV0ZShub3RpZnkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWNyaXRpY2FsRmllbGRzYF0/LmRlbGV0ZShub3RpZnkpO1xuICAgICAgICAgIGNvbnRleHRbYCR7RklFTERTX1BSRUZJWH1tdXBwZXRgXT8uZGVsZXRlKG5vdGlmeSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgdW5zdWJzY3JpYmU6XCIsIGVycik7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSxcbiAgICAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWRhdGFgXTtcbiAgICAgIH0gY2F0Y2goZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHt9IGFzIFQ7XG4gICAgICB9XG4gICAgfSxcbiAgICAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWRhdGFgXTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiB7fSBhcyBUO1xuICAgICAgfVxuICAgIH1cbiAgKTtcblxuICAvLyBAdHMtaWdub3JlXG4gIHJldHVybiBzdGF0ZSA/IHN0YXRlW3Byb3BdIDogY29udGV4dFtgJHtGSUVMRFNfUFJFRklYfWRhdGFgXVtwcm9wXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNpbXBsZVJlYWN0UHJvdmlkZXI8VCBleHRlbmRzIG9iamVjdD4odGhpczogVCwgcHJvcDoga2V5b2YgVCk6IFRba2V5b2YgVF0ge1xuICBjb25zdCBjdXJyZW50UmVhY3Rpb24gPSBSRUFDVElPTl9TVEFDS1tSRUFDVElPTl9TVEFDSy5sZW5ndGggLSAxXTtcbiAgaWYgKGN1cnJlbnRSZWFjdGlvbikge1xuICAgIGN1cnJlbnRSZWFjdGlvbi5yZXBvcnREZXBlbmRlbmN5KHRoaXMsIHByb3AgYXMgc3RyaW5nKTtcbiAgICByZXR1cm4gdGhpc1tgJHtGSUVMRFNfUFJFRklYfWRhdGFgXVtwcm9wXTtcbiAgfVxuXG4gIGxldCBpc0luUmVhY3RSZW5kZXIgPSBmYWxzZTtcbiAgaWYgKFJlYWN0Ll9fQ0xJRU5UX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1dBUk5fVVNFUlNfVEhFWV9DQU5OT1RfVVBHUkFERSkge1xuICAgIGlmIChSZWFjdC5fX0NMSUVOVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9XQVJOX1VTRVJTX1RIRVlfQ0FOTk9UX1VQR1JBREU/LkggIT09IG51bGwpIHtcbiAgICAgIGlzSW5SZWFjdFJlbmRlciA9IHRydWU7XG4gICAgfVxuICB9IGVsc2UgaWYgKFJlYWN0Py5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRD8uUmVhY3RDdXJyZW50RGlzcGF0Y2hlcj8uY3VycmVudCkge1xuICAgIGlzSW5SZWFjdFJlbmRlciA9IHRydWU7XG4gIH1cblxuICBpZiAoIWlzSW5SZWFjdFJlbmRlcikge1xuICAgIHJldHVybiB0aGlzW2Ake0ZJRUxEU19QUkVGSVh9ZGF0YWBdW3Byb3BdO1xuICB9XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gc2ltcGxlSG9vazxUPih0aGlzLCBwcm9wKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmICghKGUgaW5zdGFuY2VvZiBFcnJvcikpIHtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuXG4gICAgY29uc3QgbWVzc2FnZVRvSGFzaCA9IGUubWVzc2FnZS5zdWJzdHJpbmcoMCwgMjAwKTtcbiAgICBjb25zdCBtZXNzYWdlSGFzaCA9IHNpbXBsZUhhc2gobWVzc2FnZVRvSGFzaCk7XG5cbiAgICBjb25zb2xlLmxvZyhtZXNzYWdlSGFzaCwgS05PV05fU1BBTV9IQVNILCBlLm1lc3NhZ2UpXG4gICAgaWYgKEtOT1dOX1NQQU1fSEFTSCAmJiBtZXNzYWdlSGFzaCA9PT0gS05PV05fU1BBTV9IQVNIKSB7XG4gICAgICByZXR1cm4gdGhpc1tgJHtGSUVMRFNfUFJFRklYfWRhdGFgXVtwcm9wXTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgY29tcG9uZW50TmFtZSA9IGdldFJlbmRlcmluZ0NvbXBvbmVudE5hbWUoKTtcbiAgICB0aHJvdyBjcmVhdGVSZXBrYUVycm9yKGUsIGNvbXBvbmVudE5hbWUsIEtOT1dOX1NQQU1fSEFTSCwgbWVzc2FnZUhhc2gpO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7OztBQUFPLFNBQVMsV0FBVyxLQUFxQjtBQUM5QyxNQUFJLE9BQU87QUFDWCxXQUFTLElBQUksR0FBRyxJQUFJLElBQUksUUFBUSxLQUFLO0FBQ25DLFlBQVMsUUFBUSxLQUFLLE9BQVEsSUFBSSxXQUFXLENBQUM7QUFBQSxFQUNoRDtBQUNBLFNBQU8sT0FBTyxJQUFJO0FBQ3BCOzs7QUNOQSxPQUFPLFdBQVc7QUFPWCxTQUFTLDRCQUFvQztBQUNsRCxRQUFNLFdBQVc7QUFDakIsTUFBSTtBQUVGLFVBQU0sWUFBWSxNQUFNO0FBQ3hCLFFBQUksQ0FBQyxVQUFXLFFBQU87QUFDdkIsVUFBTSxRQUFRLFVBQVUsbUJBQW1CO0FBQzNDLFFBQUksQ0FBQyxNQUFPLFFBQU87QUFDbkIsVUFBTSxnQkFBZ0IsTUFBTTtBQUM1QixRQUFJLENBQUMsY0FBZSxRQUFPO0FBRzNCLFdBQU8sY0FBYyxlQUFlLGNBQWMsUUFBUTtBQUFBLEVBQzVELFNBQVMsR0FBRztBQUdWLFdBQU87QUFBQSxFQUNUO0FBQ0Y7OztBQ3pCQSxPQUFPQSxZQUFXO0FBR1gsSUFBSSxrQkFBaUM7QUFJNUMsSUFBTSxrQkFBa0IsTUFBTTtBQUM1QixFQUFBQSxPQUFNLFVBQVUsTUFBTTtBQUNwQixJQUFBQSxPQUFNLFNBQVM7QUFBQSxFQUNqQixHQUFHLENBQUMsQ0FBQztBQUNMLFNBQU87QUFDVDtBQUVBLElBQU0sb0JBQW9CLENBQUMsWUFBb0M7QUFDN0QsTUFBSSxNQUFNLFFBQVEsU0FBUztBQUMzQixRQUFNLElBQUksUUFBUSx3QkFBd0IsRUFBRTtBQUM1QyxTQUFPO0FBQ1Q7QUFBQSxDQUVDLFlBQVk7QUFDWCxRQUFNLFdBQVcsT0FBTyxXQUFXO0FBRW5DLE1BQUk7QUFDRixRQUFJLFVBQVU7QUFLWixZQUFNLEVBQUUsZUFBZSxJQUFJLE1BQU0sT0FBTyxrQkFBa0I7QUFFMUQsWUFBTSx1QkFBdUIsUUFBUTtBQUNyQyxjQUFRLFFBQVEsTUFBTTtBQUFBLE1BQUM7QUFFdkIsVUFBSTtBQUNGLHVCQUFlQSxPQUFNLGNBQWMsZUFBZSxDQUFDO0FBQUEsTUFDckQsU0FBUyxPQUFZO0FBRW5CLGNBQU0sZUFBZSxrQkFBa0IsTUFBTSxPQUFPO0FBQ3BELDBCQUFrQixXQUFXLGFBQWEsVUFBVSxHQUFHLEdBQUcsQ0FBQztBQUFBLE1BQzdELFVBQUU7QUFDQSxnQkFBUSxRQUFRO0FBQUEsTUFDbEI7QUFBQSxJQUVGLE9BQU87QUFFTCxZQUFNLGlCQUFpQixZQUFZO0FBQ2pDLFlBQUk7QUFDRixnQkFBTSxFQUFFLFdBQVcsSUFBSSxNQUFNLE9BQU8sa0JBQWtCO0FBRXRELGdCQUFNLFVBQVUsU0FBUyxjQUFjLEtBQUs7QUFDNUMsa0JBQVEsS0FBSztBQUNiLGtCQUFRLE1BQU0sVUFBVTtBQUN4QixtQkFBUyxLQUFLLFlBQVksT0FBTztBQUNqQyxnQkFBTSxPQUFPLFdBQVcsT0FBTztBQUcvQixnQkFBTSx1QkFBdUIsUUFBUTtBQUNyQyxnQkFBTSxrQkFBa0IsT0FBTztBQUMvQixnQkFBTSwrQkFBK0IsT0FBTztBQUc1QyxVQUFDLE9BQWUseUJBQXlCO0FBRXpDLGdCQUFNLFVBQVUsTUFBTTtBQUNwQix1QkFBVyxNQUFNO0FBRWYsY0FBQyxPQUFlLHlCQUF5QjtBQUd6QyxxQkFBTyxvQkFBb0IsU0FBUyxlQUFlLEVBQUUsU0FBUyxLQUFLLENBQUM7QUFDcEUscUJBQU8sb0JBQW9CLHNCQUFzQixtQkFBbUIsRUFBRSxTQUFTLEtBQUssQ0FBQztBQUdyRixzQkFBUSxRQUFRO0FBQ2hCLHFCQUFPLFVBQVU7QUFDakIscUJBQU8sdUJBQXVCO0FBRzlCLGtCQUFJO0FBQ0YscUJBQUssUUFBUTtBQUNiLHdCQUFRLE9BQU87QUFBQSxjQUNqQixTQUFTLEdBQUc7QUFBQSxjQUFDO0FBQUEsWUFDZixHQUFHLENBQUM7QUFBQSxVQUNOO0FBTUEsZ0JBQU0sZ0JBQWdCLENBQUMsVUFBc0I7QUFJM0MsZ0JBQUksQ0FBRSxPQUFlLHdCQUF3QjtBQUMzQztBQUFBLFlBQ0Y7QUFJQSxrQkFBTSxlQUFlLGtCQUFrQixNQUFNLE9BQU87QUFDcEQsa0JBQU0saUJBQ0osYUFBYSxTQUFTLG1CQUFtQjtBQUFBLFlBQ3pDLGFBQWEsU0FBUywyQkFBMkI7QUFFbkQsZ0JBQUksZ0JBQWdCO0FBRWxCLG9CQUFNLE9BQU8sV0FBVyxhQUFhLFVBQVUsR0FBRyxHQUFHLENBQUM7QUFDdEQsZ0NBQWtCO0FBR2xCLG9CQUFNLGVBQWU7QUFDckIsb0JBQU0seUJBQXlCO0FBQy9CLG9CQUFNLGdCQUFnQjtBQUd0QixzQkFBUTtBQUNSLHFCQUFPO0FBQUEsWUFDVDtBQUFBLFVBS0Y7QUFNQSxnQkFBTSxvQkFBb0IsQ0FBQyxVQUFpQztBQUUxRCxnQkFBSSxDQUFFLE9BQWUsd0JBQXdCO0FBQzNDO0FBQUEsWUFDRjtBQUVBLGtCQUFNLFNBQVMsTUFBTSxRQUFRLFdBQVcsTUFBTSxRQUFRLFNBQVMsS0FBSztBQUNwRSxrQkFBTSxlQUFlLGtCQUFrQixNQUFNO0FBRzdDLGtCQUFNLGlCQUNKLGFBQWEsU0FBUyxtQkFBbUI7QUFBQSxZQUN6QyxhQUFhLFNBQVMsMkJBQTJCO0FBRW5ELGdCQUFJLGdCQUFnQjtBQUVsQixvQkFBTSxPQUFPLFdBQVcsYUFBYSxVQUFVLEdBQUcsR0FBRyxDQUFDO0FBQ3RELGdDQUFrQjtBQUVsQixvQkFBTSxlQUFlO0FBQ3JCLG9CQUFNLHlCQUF5QjtBQUMvQixvQkFBTSxnQkFBZ0I7QUFFdEIsc0JBQVE7QUFBQSxZQUNWO0FBQUEsVUFDRjtBQUdBLGlCQUFPLGlCQUFpQixTQUFTLGVBQWUsRUFBRSxTQUFTLEtBQUssQ0FBQztBQUNqRSxpQkFBTyxpQkFBaUIsc0JBQXNCLG1CQUFtQixFQUFFLFNBQVMsS0FBSyxDQUFDO0FBR2xGLGtCQUFRLFFBQVEsTUFBTTtBQUFBLFVBQUM7QUFLdkIsaUJBQU8sVUFBVSxTQUFVLFNBQVE7QUFDakMsZ0JBQUssT0FBZSx3QkFBd0I7QUFDMUMscUJBQU87QUFBQSxZQUNUO0FBQ0EsbUJBQU8sa0JBQWtCLGdCQUFnQixNQUFNLFFBQVEsU0FBZ0IsSUFBSTtBQUFBLFVBQzdFO0FBRUEsaUJBQU8sdUJBQXVCLENBQUMsVUFBVTtBQUN0QyxnQkFBSyxPQUFlLHdCQUF3QjtBQUMzQyxxQkFBTztBQUFBLFlBQ1Q7QUFDQSxtQkFBTywrQkFBK0IsNkJBQTZCLE1BQU0sUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJO0FBQUEsVUFDOUY7QUFLQSxVQUFDLE9BQWUseUJBQXlCO0FBSXpDLGVBQUssT0FBT0EsT0FBTSxjQUFjLGVBQWUsQ0FBQztBQUFBLFFBS2xELFNBQVMsR0FBUTtBQUVmLGNBQUssT0FBZSxzQkFBc0I7QUFDeEMsb0JBQVEsUUFBUyxPQUFlO0FBQUEsVUFDbEM7QUFDQSxjQUFLLE9BQWUsaUJBQWlCO0FBQ25DLG1CQUFPLFVBQVcsT0FBZTtBQUFBLFVBQ25DO0FBQ0EsY0FBSyxPQUFlLDhCQUE4QjtBQUNoRCxtQkFBTyx1QkFBd0IsT0FBZTtBQUFBLFVBQ2hEO0FBQ0Esa0JBQVEsTUFBTSxxTEFBa0UsQ0FBQztBQUFBLFFBQ25GO0FBQUEsTUFDRjtBQUdBLGlCQUFXLGdCQUFnQixDQUFDO0FBQUEsSUFDOUI7QUFBQSxFQUNGLFNBQVMsR0FBUTtBQUNmLFlBQVEsTUFBTSxpTEFBeUQsQ0FBQztBQUFBLEVBQzFFO0FBQ0YsR0FBRzs7O0FDck5ILE9BQU9DLFlBQVc7QUFRWCxTQUFTLGlCQUNkLGVBQ0EsZUFDQSxVQUNBLFdBQ087QUFDUCxRQUFNLFVBQVUseUJBQXlCO0FBQ3pDLFFBQU0sVUFBVSxVQUFVLGNBQWMsVUFBVSxPQUFPLGFBQWE7QUFFdEUsUUFBTSxhQUFhLElBQUk7QUFBQSxJQUNyQiw2QkFBNkIsYUFBYTtBQUFBO0FBQUE7QUFBQTtBQUFBLG9CQUdyQixRQUFRLHNCQUFzQixTQUFTO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBSXZELE9BQU87QUFBQSxFQUNkO0FBR0EsYUFBVyxRQUFRO0FBQ25CLFNBQU87QUFDVDtBQUVPLElBQU0sYUFBYSxDQUFtQixTQUFZLFNBQThCO0FBQ3JGLFFBQU0sVUFBVUEsT0FBTTtBQUN0QixNQUFJLENBQUMsU0FBUztBQUNaLFdBQU8sUUFBUSxHQUFHLGFBQWEsTUFBTSxFQUFFLElBQUk7QUFBQSxFQUM3QztBQUVBLFFBQU0sUUFBUTtBQUFBLElBQ1osQ0FBQyxXQUFXO0FBQ1YsVUFBSTtBQUNGLGNBQU0sY0FBYztBQUVwQixZQUNFLFFBQVEsR0FBRyxhQUFhLFdBQVcsRUFBRSxXQUFXLEtBQ2hELE9BQU8sUUFBUSxHQUFHLGFBQWEsV0FBVyxFQUFFLFdBQVcsRUFBRSxRQUFRLFlBQ2pFO0FBQ0Esa0JBQVEsR0FBRyxhQUFhLFdBQVcsRUFBRSxXQUFXLEVBQUUsSUFBSSxRQUFRLE1BQU07QUFBQSxRQUN0RTtBQUVBLFlBQ0UsUUFBUSxHQUFHLGFBQWEsZ0JBQWdCLEtBQ3hDLE9BQU8sUUFBUSxHQUFHLGFBQWEsZ0JBQWdCLEVBQUUsUUFBUSxZQUN6RDtBQUNBLGtCQUFRLEdBQUcsYUFBYSxnQkFBZ0IsRUFBRSxJQUFJLFFBQVEsQ0FBQyxXQUFXLENBQUM7QUFBQSxRQUNyRTtBQUVBLFlBQ0UsUUFBUSxHQUFHLGFBQWEsUUFBUSxLQUNoQyxPQUFPLFFBQVEsR0FBRyxhQUFhLFFBQVEsRUFBRSxRQUFRLFlBQ2pEO0FBQ0Esa0JBQVEsR0FBRyxhQUFhLFFBQVEsRUFBRSxJQUFJLFFBQVEsSUFBSTtBQUFBLFFBQ3BEO0FBQUEsTUFDRixTQUFTLEtBQUs7QUFDWixnQkFBUSxNQUFNLDJCQUEyQixLQUFLLElBQUk7QUFBQSxNQUNwRDtBQUVBLGFBQU8sTUFBTTtBQUNYLFlBQUk7QUFDRixrQkFBUSxHQUFHLGFBQWEsUUFBUSxHQUFHLElBQUksUUFBUSxLQUFLO0FBRXBELGdCQUFNLFNBQVMsUUFBUSxHQUFHLGFBQWEsZ0JBQWdCLEdBQUcsSUFBSSxNQUFNO0FBQ3BFLGNBQUksUUFBUTtBQUNWLG1CQUFPLFFBQVEsT0FBSztBQUNsQixzQkFBUSxHQUFHLGFBQWEsV0FBVyxFQUFFLENBQUMsR0FBRyxPQUFPLE1BQU07QUFBQSxZQUN4RCxDQUFDO0FBQUEsVUFDSDtBQUVBLGtCQUFRLEdBQUcsYUFBYSxnQkFBZ0IsR0FBRyxPQUFPLE1BQU07QUFDeEQsa0JBQVEsR0FBRyxhQUFhLFFBQVEsR0FBRyxPQUFPLE1BQU07QUFBQSxRQUNsRCxTQUFTLEtBQUs7QUFDWixrQkFBUSxNQUFNLDZCQUE2QixHQUFHO0FBQUEsUUFDaEQ7QUFBQSxNQUNGO0FBQUEsSUFDRjtBQUFBLElBQ0EsTUFBTTtBQUNKLFVBQUk7QUFDRixlQUFPLFFBQVEsR0FBRyxhQUFhLE1BQU07QUFBQSxNQUN2QyxTQUFRLE9BQU87QUFDYixlQUFPLENBQUM7QUFBQSxNQUNWO0FBQUEsSUFDRjtBQUFBLElBQ0EsTUFBTTtBQUNKLFVBQUk7QUFDRixlQUFPLFFBQVEsR0FBRyxhQUFhLE1BQU07QUFBQSxNQUN2QyxTQUFTLE9BQU87QUFDZCxlQUFPLENBQUM7QUFBQSxNQUNWO0FBQUEsSUFDRjtBQUFBLEVBQ0Y7QUFHQSxTQUFPLFFBQVEsTUFBTSxJQUFJLElBQUksUUFBUSxHQUFHLGFBQWEsTUFBTSxFQUFFLElBQUk7QUFDbkU7QUFFTyxTQUFTLG9CQUErQyxNQUEyQjtBQUN4RixRQUFNLGtCQUFrQixlQUFlLGVBQWUsU0FBUyxDQUFDO0FBQ2hFLE1BQUksaUJBQWlCO0FBQ25CLG9CQUFnQixpQkFBaUIsTUFBTSxJQUFjO0FBQ3JELFdBQU8sS0FBSyxHQUFHLGFBQWEsTUFBTSxFQUFFLElBQUk7QUFBQSxFQUMxQztBQUVBLE1BQUksa0JBQWtCO0FBQ3RCLE1BQUlBLE9BQU0saUVBQWlFO0FBQ3pFLFFBQUlBLE9BQU0saUVBQWlFLE1BQU0sTUFBTTtBQUNyRix3QkFBa0I7QUFBQSxJQUNwQjtBQUFBLEVBQ0YsV0FBV0EsUUFBTyxvREFBb0Qsd0JBQXdCLFNBQVM7QUFDckcsc0JBQWtCO0FBQUEsRUFDcEI7QUFFQSxNQUFJLENBQUMsaUJBQWlCO0FBQ3BCLFdBQU8sS0FBSyxHQUFHLGFBQWEsTUFBTSxFQUFFLElBQUk7QUFBQSxFQUMxQztBQUVBLE1BQUk7QUFDRixXQUFPLFdBQWMsTUFBTSxJQUFJO0FBQUEsRUFDakMsU0FBUyxHQUFHO0FBQ1YsUUFBSSxFQUFFLGFBQWEsUUFBUTtBQUN6QixZQUFNO0FBQUEsSUFDUjtBQUVBLFVBQU0sZ0JBQWdCLEVBQUUsUUFBUSxVQUFVLEdBQUcsR0FBRztBQUNoRCxVQUFNLGNBQWMsV0FBVyxhQUFhO0FBRTVDLFlBQVEsSUFBSSxhQUFhLGlCQUFpQixFQUFFLE9BQU87QUFDbkQsUUFBSSxtQkFBbUIsZ0JBQWdCLGlCQUFpQjtBQUN0RCxhQUFPLEtBQUssR0FBRyxhQUFhLE1BQU0sRUFBRSxJQUFJO0FBQUEsSUFDMUM7QUFFQSxVQUFNLGdCQUFnQiwwQkFBMEI7QUFDaEQsVUFBTSxpQkFBaUIsR0FBRyxlQUFlLGlCQUFpQixXQUFXO0FBQUEsRUFDdkU7QUFDRjsiLAogICJuYW1lcyI6IFsiUmVhY3QiLCAiUmVhY3QiXQp9Cg==
