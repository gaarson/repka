{
  "version": 3,
  "sources": ["../../packages/core/index.ts"],
  "sourcesContent": ["import {ICallable, Callable, SPECIAL_KEY, FIELDS_PREFIX} from './domain';\n\nfunction get(obj, prop) {\n  if (\n    obj[`${FIELDS_PREFIX}muppet`].get(SPECIAL_KEY)\n    && prop !== obj[`${FIELDS_PREFIX}muppet`].get(SPECIAL_KEY)\n    && (typeof prop === 'string' && !prop.startsWith(FIELDS_PREFIX))\n    && !obj[`${FIELDS_PREFIX}methods`][prop]\n  ) {\n    const currentKey = obj[`${FIELDS_PREFIX}muppet`].get(SPECIAL_KEY);\n    obj[`${FIELDS_PREFIX}muppet`].set(currentKey, false);\n    \n    const currentFields = obj[`${FIELDS_PREFIX}criticalFields`].get(currentKey) || [];\n    obj[`${FIELDS_PREFIX}criticalFields`].set(currentKey, [...new Set([\n      ...currentFields,\n      prop\n    ])]);\n  }\n  if ((typeof prop === 'string' && prop.startsWith(FIELDS_PREFIX)) || prop === '__call') {\n    return obj[prop]\n  }\n  if (obj[`${FIELDS_PREFIX}methods`][prop]) return obj[`${FIELDS_PREFIX}methods`][prop];\n\n  if (obj[`${FIELDS_PREFIX}getter`]) return obj[`${FIELDS_PREFIX}getter`](prop);\n\n  return obj[`${FIELDS_PREFIX}data`][prop];\n}\n\nconst set = (obj, prop, value, receiver): boolean => {\n  if ((typeof prop === 'string' && prop.startsWith(FIELDS_PREFIX)) || prop === '__call') {\n    obj[prop] = value;\n    return true;\n  }\n\n  if (!obj[`${FIELDS_PREFIX}methods`][prop]) {\n    obj[`${FIELDS_PREFIX}data`] = {\n      ...obj[`${FIELDS_PREFIX}data`],\n      [prop]: value\n    };\n\n    if (obj[`${FIELDS_PREFIX}listeners`][prop] && obj[`${FIELDS_PREFIX}listeners`][prop].size) {\n      obj[`${FIELDS_PREFIX}listeners`][prop].forEach((notify, key) => {\n        if (obj[`${FIELDS_PREFIX}muppet`].has(key)\n            && obj[`${FIELDS_PREFIX}muppet`].get(key) === false) {\n          obj[`${FIELDS_PREFIX}muppet`].set(key, true);\n        }\n\n        notify();\n      });\n    }\n    if (obj[`${FIELDS_PREFIX}onUpdate`].length) {\n      obj[`${FIELDS_PREFIX}onUpdate`].forEach(\n        (fn: (...args: any[]) => void) => fn && fn(prop, value, receiver)\n      );\n    }\n  }\n\n  return true;\n}\n\nexport interface ISource<T, P> {\n  <DataType = T, Provider = P >( data: DataType, provider?: Provider): DataType;\n}\n\nfunction getAllMethodNames(toCheck: {[key: string]: unknown}) {\n  const props = [];\n  let obj = toCheck;\n  do {\n    props.push(...Object.getOwnPropertyNames(obj));\n  } while (obj = Object.getPrototypeOf(obj));\n  \n  return props.sort().filter((e, i, arr) => {\n    if (e != arr[i + 1] && typeof toCheck[e] == 'function') {\n       \n      if (`${FIELDS_PREFIX}data` in toCheck[e]) {\n        return false;\n      }\n      return true;\n    } \n  });\n}\n\nexport const createSource = <\n  T extends {},\n  O extends {main?: (...args: any[]) => any, getter?: (...args: any[]) => any}\n>(\n  data: T,\n  {main, getter}: O\n): T & ICallable<ReturnType<O['main']>, Parameters<O['main']>> => {\n  try {\n    const dummyImplementation = (() => {}) as O['main'];\n    const callableObj = new Callable(dummyImplementation);\n    const methodsKeys = new Set(\n      getAllMethodNames(data).filter(\n        key => key !== 'constructor' && typeof data[key] === 'function' ? true : false\n      )\n    );\n    const obj = Object.keys(data).reduce((acc, key) => {\n      if (methodsKeys.has(key)) return acc\n\n      acc[key] = data[key]\n      return acc;\n    }, callableObj)\n\n    const proxy: T & ICallable<ReturnType<O['main']>, Parameters<O['main']>> = new Proxy(obj, {set, get: get.bind(this)});\n\n    const methods = [...methodsKeys].reduce(\n      (prev, curr) => (curr !== 'constructor' && typeof data[curr] === 'function')\n        ? { ...prev, [curr]: data[curr].bind(proxy) }\n        : prev,\n      {} as T\n    );\n    proxy[`${FIELDS_PREFIX}methods`] = methods;\n    proxy[`${FIELDS_PREFIX}onUpdate`] = [];\n    proxy[`${FIELDS_PREFIX}data`] = data;\n    \n    proxy[`${FIELDS_PREFIX}criticalFields`] = new Map();\n    proxy[`${FIELDS_PREFIX}muppet`] = new Map();\n\n    proxy[`${FIELDS_PREFIX}listeners`] = Object.keys(obj).reduce(\n      (prev, key) => !key.startsWith(FIELDS_PREFIX) && key !== '__call'\n        ? ({ ...prev, [key]: new Map() })\n        : prev,\n        {}\n    );\n\n    if (getter) {\n      proxy[`${FIELDS_PREFIX}getter`] = getter.bind(proxy);\n    }\n\n    if (main) {\n      proxy.__call = main.bind(proxy);\n    }\n\n    return proxy;\n  } catch (error) {\n    console.error('SOURCE OBJECT ERROR: ', error);\n  }\n};\n"],
  "mappings": "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",
  "names": []
}
