import{a as d,b as t,c}from"./RRIRANBE.chunk.js";var i=class{constructor(){this.keys=[];this.SPECIAL_KEY=d}init(e,r={}){typeof e=="object"&&!Array.isArray(e)&&(this.keys=Object.keys(e||{}),this.sourceObj=c(e,r.provider,r.methods)),r.broadcastName&&this.createBroadcast(r.broadcastName)}createBroadcast(e="broadcastWatcher"){this.broadcast=new BroadcastChannel(e),this.broadcast.onmessage=({data:r})=>{if(r==="needSome")this.broadcast.postMessage({data:this.get()});else if(r.type===void 0)for(let o in r.data)this.sourceObj[o]=r.data[o]},this.broadcast.postMessage("needSome")}set(e,r,o=!1){this.sourceObj&&(this.sourceObj[e]=r),this.broadcast&&!o&&this.broadcast.postMessage({type:e,data:r})}get(e){if(this.sourceObj&&e)return this.sourceObj[`${t}data`][e];if(!e)return this.sourceObj[`${t}data`]}watch(e){let r=this.sourceObj[`${t}onUpdate`].length;return new Promise(o=>{this.sourceObj[`${t}onUpdate`]=[...this.sourceObj[`${t}onUpdate`],s=>{e===s&&(o(this.sourceObj[e]),this.sourceObj[`${t}onUpdate`][r]=null,this.sourceObj[`${t}onUpdate`].every(a=>a===null)&&(this.sourceObj[`${t}onUpdate`]=[]))}]})}watchFor(e,r){let o=this.sourceObj[`${t}onUpdate`].length;return new Promise(s=>{this.sourceObj[`${t}onUpdate`]=[...this.sourceObj[`${t}onUpdate`],a=>{e===a&&this.sourceObj[e]===r&&(s(this.sourceObj[e]),this.sourceObj[`${t}onUpdate`][o]=null,this.sourceObj[`${t}onUpdate`].every(p=>p===null)&&(this.sourceObj[`${t}onUpdate`]=[]))}]})}},f=(n,e,r,o)=>{let s=new i;return s.init(n,{provider:e,methods:r,broadcastName:o}),s};export{i as a,f as b};
