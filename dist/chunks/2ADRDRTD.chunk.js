import{b as n,c as t,d as c}from"./Z46EOYFR.chunk.js";var a=class{constructor(){this.SPECIAL_KEY=n}init(e,r={}){typeof e=="object"&&!Array.isArray(e)&&(r.provider&&(this.savedProvider=r.provider),this.sourceObj=c(e,r.methods,r.provider||this.savedProvider)),r.broadcastName&&this.createBroadcast(r.broadcastName)}createBroadcast(e="broadcastWatcher"){this.broadcast=new BroadcastChannel(e),this.broadcast.onmessage=({data:r})=>{if(r==="needSome")this.broadcast.postMessage({data:this.get()});else if(r.type===void 0)for(let o in r.data)this.sourceObj[o]=r.data[o]},this.broadcast.postMessage("needSome")}set(e,r,o=!1){this.sourceObj&&(this.sourceObj[e]=r),this.broadcast&&!o&&this.broadcast.postMessage({type:e,data:r})}get(e){if(this.sourceObj&&e)return this.sourceObj[e];if(!e)return this.sourceObj[`${t}data`]}watch(e){let r=this.sourceObj[`${t}onUpdate`].length;return new Promise(o=>{this.sourceObj[`${t}onUpdate`]=[...this.sourceObj[`${t}onUpdate`],s=>{e===s&&(o(this.sourceObj[e]),this.sourceObj[`${t}onUpdate`][r]=null,this.sourceObj[`${t}onUpdate`].every(i=>i===null)&&(this.sourceObj[`${t}onUpdate`]=[]))}]})}watchFor(e,r){let o=this.sourceObj[`${t}onUpdate`].length;return new Promise(s=>{this.sourceObj[`${t}onUpdate`]=[...this.sourceObj[`${t}onUpdate`],i=>{e===i&&this.sourceObj[e]===r&&(s(this.sourceObj[e]),this.sourceObj[`${t}onUpdate`][o]=null,this.sourceObj[`${t}onUpdate`].every(p=>p===null)&&(this.sourceObj[`${t}onUpdate`]=[]))}]})}},f=(d,e,r,o)=>{let s=new a;return s.init(d,{provider:e,methods:r,broadcastName:o}),s};export{a,f as b};
