{
  "version": 3,
  "sources": ["../../packages/react-provider/index.ts"],
  "sourcesContent": ["import React from 'react';\nimport { FIELDS_PREFIX } from 'core/domain';\nimport { REACTION_STACK } from 'reaction';\n\nlet hasWarned = false;\n\nexport const simpleHook = <T extends object>(context: any, prop: keyof T): T[keyof T] => {\n  const useSync = React.useSyncExternalStore;\n  if (!useSync) {\n    return context[`${FIELDS_PREFIX}data`][prop];\n  }\n\n  const state = useSync(\n    (notify) => {\n      try {\n        const currentProp = prop;\n\n        if (\n          context[`${FIELDS_PREFIX}listeners`][currentProp] &&\n          typeof context[`${FIELDS_PREFIX}listeners`][currentProp].set === 'function'\n        ) {\n          context[`${FIELDS_PREFIX}listeners`][currentProp].set(notify, notify);\n        }\n\n        if (\n          context[`${FIELDS_PREFIX}criticalFields`] &&\n          typeof context[`${FIELDS_PREFIX}criticalFields`].set === 'function'\n        ) {\n          context[`${FIELDS_PREFIX}criticalFields`].set(notify, [currentProp]);\n        }\n        \n        if (\n          context[`${FIELDS_PREFIX}muppet`] &&\n          typeof context[`${FIELDS_PREFIX}muppet`].set === 'function'\n        ) {\n          context[`${FIELDS_PREFIX}muppet`].set(notify, true);\n        }\n      } catch (err) {\n        console.error(\"Error during subscribe:\", err, prop);\n      }\n\n      return () => {\n        try {\n          context[`${FIELDS_PREFIX}muppet`]?.set(notify, false);\n\n          const fields = context[`${FIELDS_PREFIX}criticalFields`]?.get(notify);\n          if (fields) {\n            fields.forEach(p => {\n              context[`${FIELDS_PREFIX}listeners`][p]?.delete(notify);\n            });\n          }\n\n          context[`${FIELDS_PREFIX}criticalFields`]?.delete(notify);\n          context[`${FIELDS_PREFIX}muppet`]?.delete(notify);\n        } catch (err) {\n          console.error(\"Error during unsubscribe:\", err);\n        }\n      };\n    },\n    () => {\n      try {\n        return context[`${FIELDS_PREFIX}data`];\n      } catch(error) {\n        return {};\n      }\n    },\n    () => {\n      try {\n        return context[`${FIELDS_PREFIX}data`];\n      } catch (error) {\n        return {};\n      }\n    }\n  );\n\n  return state ? state[prop] : context[`${FIELDS_PREFIX}data`][prop];\n}\n\nexport function simpleReactProvider<T extends object>(prop: keyof T): T[keyof T] {\n  let isInReactRender = false;\n\n  if (!hasWarned) {\n    console.warn(`[Repka] \u0412\u041D\u0418\u041C\u0410\u041D\u0418\u0415: \u041E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D \u043F\u0440\u044F\u043C\u043E\u0439 \u0434\u043E\u0441\u0442\u0443\u043F \u043A 'state.${String(prop)}' \u0432 \u0440\u0435\u043D\u0434\u0435\u0440\u0435...`);\n\n    hasWarned = true;\n  }\n\n  if (React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE) {\n\u00A0 \u00A0 if (React.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE?.H !== null) {\n\u00A0 \u00A0 \u00A0 isInReactRender = true;\n\u00A0 \u00A0 }\n\u00A0 } else if (React.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED?.ReactCurrentDispatcher?.current) {\n\u00A0 \u00A0 \u00A0 isInReactRender = true;\n\u00A0 }\n\n  if (!isInReactRender) {\n    return this[`${FIELDS_PREFIX}data`][prop];\n  }\n\n  const currentReaction = REACTION_STACK[REACTION_STACK.length - 1];\n  if (currentReaction) {\n    currentReaction.reportDependency(this, prop as string);\n    return this[`${FIELDS_PREFIX}data`][prop];\n  }\n  \n  try {\n    React.useId();\n  } catch (error) {\n    return this[`${FIELDS_PREFIX}data`][prop];\n  }\n\n  return simpleHook<T>(this, prop)\n}\n"],
  "mappings": "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",
  "names": []
}
