var T=Object.defineProperty,k=Object.defineProperties,w=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertyNames,f=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var g=(i,n,e)=>n in i?T(i,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[n]=e,y=(i,n)=>{for(var e in n||(n={}))h.call(n,e)&&g(i,e,n[e]);if(f)for(var e of f(n))v.call(n,e)&&g(i,e,n[e]);return i},d=(i,n)=>k(i,m(n));var M=(i,n)=>{for(var e in n)T(i,e,{get:n[e],enumerable:!0})},P=(i,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of R(n))!h.call(i,r)&&r!==e&&T(i,r,{get:()=>n[r],enumerable:!(t=w(n,r))||t.enumerable});return i};var x=i=>P(T({},"__esModule",{value:!0}),i);var O={};M(O,{RepositoryService:()=>l});module.exports=x(O);var c=class extends Function{constructor(){super();let n;return n=(...e)=>n.__call(...e),Object.setPrototypeOf(n,new.target.prototype)}};var l=class extends c{constructor(e,t){super();this._watcherFactory=e;this._provider=t;this.keys=[];this.provider=t,this.actions=this.initRepository()}__call(e,t,r){let p,o,s=null;return t&&(o=(t.constructor.name==="Object"?Object.keys(t):Object.getOwnPropertyNames(Object.getPrototypeOf(t))).reduce((_,u)=>u!=="constructor"&&typeof t[u]=="function"?d(y({},_),{[u]:t[u].bind(t)}):_,{})),t?t.repo?(t.repo.initializeState(e),t.repo.initializeState(e,o)):(t.repo=this,t.repo.initializeState(e),t.repo.initializeState(e,o)):s=this.initRepository(e,o),r&&(p=new BroadcastChannel(`repository-${r}`),p.onmessage=({data:a})=>{a==="needSome"?p.postMessage({data:(s||t.repo.actions).convertToObject()}):a.type===void 0?this.initRepository(a.data):(s||t.repo.actions).set(a.type,a.data)},p.postMessage("needSome")),(s||t.repo.actions).sourceObj}initializeState(e,t){this.actions=this.initRepository(e,t)}initRepository(e,t){this.keys=Object.keys(e||{});let r=this.keys.reduce((p,o)=>{let s;return this.actions!==void 0&&this.actions.get(o)!==void 0?s=this.actions.get(o):s=e[o],d(y({},p),{[o]:s})},e||{});return this._watcherFactory(r,this.provider,t)}convertToObject(){return this.keys.reduce((e,t)=>d(y({},e),{[t]:this.actions.get(t)}),{})}};
