var T=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var k=(r,n)=>{for(var t in n)T(r,t,{get:n[t],enumerable:!0})},f=(r,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of g(n))!h.call(r,i)&&i!==t&&T(r,i,{get:()=>n[i],enumerable:!(e=l(n,i))||e.enumerable});return r};var w=r=>f(T({},"__esModule",{value:!0}),r);var m={};k(m,{RepositoryService:()=>u});module.exports=w(m);var d=class extends Function{constructor(){super();let n;return n=(...t)=>n._call(...t),Object.setPrototypeOf(n,new.target.prototype)}};var u=class extends d{constructor(t,e){super();this._watcherFactory=t;this._provider=e;this.keys=[];this.provider=e,this.actions=this.initRepository()}_call(t,e,i){let p,o,s=null;return e&&(o=(e.constructor.name==="Object"?Object.keys(e):Object.getOwnPropertyNames(Object.getPrototypeOf(e))).reduce((c,y)=>y!=="constructor"&&typeof e[y]=="function"?{...c,[y]:e[y].bind(e)}:c,{})),e?e.repo?(e.repo.initializeState(t),e.repo.initializeState(t,o)):(e.repo=this,e.repo.initializeState(t),e.repo.initializeState(t,o)):s=this.initRepository(t,o),i&&(p=new BroadcastChannel(`repository-${i}`),p.onmessage=({data:a})=>{a==="needSome"?p.postMessage({data:(s||e.repo.actions).convertToObject()}):a.type===void 0?this.initRepository(a.data):(s||e.repo.actions).set(a.type,a.data)},p.postMessage("needSome")),(s||e.repo.actions).sourceObj}initializeState(t,e){this.actions=this.initRepository(t,e)}initRepository(t,e){this.keys=Object.keys(t||{});let i=this.keys.reduce((p,o)=>{let s;return this.actions!==void 0&&this.actions.get(o)!==void 0?s=this.actions.get(o):s=t[o],{...p,[o]:[s]}},t||{});return this._watcherFactory(i,this.provider,e)}convertToObject(){return this.keys.reduce((t,e)=>({...t,[e]:this.actions.get(e)}),{})}};
