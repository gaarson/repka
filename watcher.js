var T=Object.defineProperty,k=Object.defineProperties,m=Object.getOwnPropertyDescriptor,w=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var _=(n,e,t)=>e in n?T(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,l=(n,e)=>{for(var t in e||(e={}))g.call(e,t)&&_(n,t,e[t]);if(h)for(var t of h(e))I.call(e,t)&&_(n,t,e[t]);return n},c=(n,e)=>k(n,w(e));var C=(n,e)=>{for(var t in e)T(n,t,{get:e[t],enumerable:!0})},M=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of O(e))!g.call(n,r)&&r!==t&&T(n,r,{get:()=>e[r],enumerable:!(s=m(e,r))||s.enumerable});return n};var v=n=>M(T({},"__esModule",{value:!0}),n);var j={};C(j,{Watcher:()=>d,watcherCreator:()=>x});module.exports=v(j);var i="__PROVIDER_ID__",u=class extends Function{constructor(){super();let e;return e=(...t)=>e.__call(...t),Object.setPrototypeOf(e,new.target.prototype)}},y=class extends u{constructor(t,s,r,a){super();this.__call=t;this.__methods=r;this.__onUpdate=[];this.__listeners={};this.call=void 0;for(let o in s)this[o]=s[o];this.muppet=new Proxy({},{get:a.bind(this)})}},b=(n,e,t)=>{function s(r,a){return r[i]&&typeof r[i]=="string"&&a!==r[i]&&(r[r[i]]?r[r[i]]=c(l({},r[r[i]]),{[a]:this[a]!==void 0?this[a]:void 0}):r[r[i]]={[a]:this[a]!==void 0?this[a]:void 0}),r[a]?r[a]:this[a]}return new Proxy(new y(e,n,t,s),{set(r,a,o){if(r[a]=o,r.__listeners[a]&&r.__listeners[a].size)for(let[p,f]of r.__listeners[a])r.muppet[p]&&(r.muppet[p]=c(l({},r.muppet[p]),{[a]:o})),f();return Array.isArray(r.__onUpdate)&&a!=="onUpdate"&&(r.__onUpdate.forEach(p=>p()),r.__onUpdate=[]),!0}})};var d=class{constructor(){this.keys=[];this.SPECIAL_KEY=i}init(e,t={}){typeof e=="object"&&!Array.isArray(e)&&(this.keys=Object.keys(e||{}),this.sourceObj=b(e,t.provider,t.methods)),t.broadcastName&&this.createBroadcast(t.broadcastName)}createBroadcast(e="broadcastWatcher"){this.broadcast=new BroadcastChannel(e),this.broadcast.onmessage=({data:t})=>{if(t==="needSome")this.broadcast.postMessage({data:this.get()});else if(t.type===void 0)for(let s in t.data)this.sourceObj[s]=t.data[s];else this.set(t.type,t.data,!0)},this.broadcast.postMessage("needSome")}set(e,t,s=!1){this.sourceObj&&e!=="name"&&e!=="length"&&(this.sourceObj[e]=t),this.broadcast&&!s&&this.broadcast.postMessage({type:e,data:t})}get(e){if(this.sourceObj&&e)return this.sourceObj[e];if(!e)return this.keys.reduce((t,s)=>c(l({},t),{[s]:this.sourceObj[s]}),{})}watch(e){return new Promise(t=>{this.sourceObj.__onUpdate=[...this.sourceObj.__onUpdate,()=>{this.sourceObj[e]&&t(this.sourceObj[e])}]})}watchFor(e,t){return new Promise(s=>{this.sourceObj.__onUpdate=[...this.sourceObj.__onUpdate,()=>{this.sourceObj[e]===t&&s(this.sourceObj[e])}]})}},x=(n,e,t,s)=>{let r=new d;return r.init(n,{provider:e,methods:t,broadcastName:s}),r};
