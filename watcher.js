var a=Object.defineProperty,f=Object.defineProperties,O=Object.getOwnPropertyDescriptor,k=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var _=(r,e,t)=>e in r?a(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,u=(r,e)=>{for(var t in e||(e={}))g.call(e,t)&&_(r,t,e[t]);if(d)for(var t of d(e))b.call(e,t)&&_(r,t,e[t]);return r},y=(r,e)=>f(r,k(e));var I=(r,e)=>{for(var t in e)a(r,t,{get:e[t],enumerable:!0})},M=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of m(e))!g.call(r,i)&&i!==t&&a(r,i,{get:()=>e[i],enumerable:!(n=O(e,i))||n.enumerable});return r};var x=r=>M(a({},"__esModule",{value:!0}),r);var P={};I(P,{Watcher:()=>T,watcherCreator:()=>v});module.exports=x(P);var p="__PROVIDER_ID__",c=class extends Function{constructor(){super();let e;return e=(...t)=>e.__call(...t),Object.setPrototypeOf(e,new.target.prototype)}},l=class extends c{constructor(t,n,i){super();this.__call=t;this.__methods=i;this.__onUpdate=[];this.__listeners={};this.muppet=new Proxy({},{get(t,n){return t[p]&&typeof t[p]=="string"&&n!==t[p]&&(t[t[p]]?t[t[p]]=y(u({},t[t[p]]),{[n]:t.init[n]||void 0}):t[t[p]]={[n]:t.init[n]||void 0}),t[n]?t[n]:t.init[n]}});this.call=void 0,this.muppet.init=n;for(let s in n)this[s]=n[s]}},h=(r,e,t)=>new Proxy(new l(e,r,t),{set(n,i,s){if(n[i]=s,n.__listeners[i]&&n.__listeners[i].size)for(let[o,w]of n.__listeners[i])n.muppet[o]&&(n.muppet[o]=y(u({},n.muppet[o]),{[i]:s})),w();return Array.isArray(n.__onUpdate)&&i!=="onUpdate"&&(n.__onUpdate.forEach(o=>o()),n.__onUpdate=[]),!0}});var T=class{constructor(){this.SPECIAL_KEY=p}init(e,t,n){typeof e=="object"&&(this.sourceObj=h(e,t,n))}set(e,t){this.sourceObj&&e!=="name"&&e!=="length"&&(this.sourceObj[e]=t)}get(e){if(this.sourceObj&&e)return this.sourceObj[e]}watch(e){return new Promise(t=>{this.sourceObj.__onUpdate=[...this.sourceObj.__onUpdate,()=>{this.sourceObj[e]&&t(this.sourceObj[e])}]})}watchFor(e,t){return new Promise(n=>{this.sourceObj.__onUpdate=[...this.sourceObj.__onUpdate,()=>{this.sourceObj[e]===t&&n(this.sourceObj[e])}]})}},v=(r,e,t)=>{let n=new T;return n.init(r,e,t),n};
